<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.88.0">
<meta name=description content="gohper">
<meta name=author content="axlrose">
<link rel=icon href=/images/favicon.png type=image/png>
<title>Golang Search Slice :: Axlrose's blog</title>
<link href=/css/nucleus.css?1698402356 rel=stylesheet>
<link href=/css/fontawesome-all.min.css?1698402356 rel=stylesheet>
<link href=/css/hybrid.css?1698402356 rel=stylesheet>
<link href=/css/featherlight.min.css?1698402356 rel=stylesheet>
<link href=/css/perfect-scrollbar.min.css?1698402356 rel=stylesheet>
<link href=/css/auto-complete.css?1698402356 rel=stylesheet>
<link href=/css/atom-one-dark.min.css?1698402356 rel=stylesheet>
<link href=/css/theme.css?1698402356 rel=stylesheet>
<link href=/css/hugo-theme.css?1698402356 rel=stylesheet>
<link href=/css/theme-blue.css?1698402356 rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js?1698402356></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style>
</head>
<body data-url=/algorithm/golang-search-slice/>
<nav id=sidebar class=showVisitedLinks>
<div id=header-wrapper>
<div id=header>
<a id=logo href=/>
<img src=/images/logo.png height=40px>&emsp;<span style=font-size:36px;color:#fff>Axlrose</span>
</a>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=/js/lunr.min.js?1698402356></script>
<script type=text/javascript src=/js/auto-complete.js?1698402356></script>
<script type=text/javascript>var baseurl="http://echotrue.github.io/"</script>
<script type=text/javascript src=/js/search.js?1698402356></script>
</div>
<section id=homelinks>
<ul>
<li>
<a class=padding href=/><i class="fas fa-home"></i> Home</a>
</li>
</ul>
</section>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/golang/ title=Golang class=dd-item>
<a href=/golang/>
<b>1. </b>Golang
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/golang/context/ title=Context class=dd-item>
<a href=/golang/context/>
Context
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/array-slice/ title="Array And Slice" class=dd-item>
<a href=/golang/array-slice/>
Array And Slice
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/uint-int/ title="Uint Int" class=dd-item>
<a href=/golang/uint-int/>
Uint Int
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/functional-programming-in-golang/ title="Functional Programming in Golang" class=dd-item>
<a href=/golang/functional-programming-in-golang/>
Functional Programming in Golang
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/binary-an-bit-operation/ title="Binary an Bit Operation" class=dd-item>
<a href=/golang/binary-an-bit-operation/>
Binary an Bit Operation
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/lock/ title=Lock class=dd-item>
<a href=/golang/lock/>
Lock
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/make-and-new/ title="Golang make and new" class=dd-item>
<a href=/golang/make-and-new/>
Golang make and new
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/panic-and-recover/ title="Panic and Recover" class=dd-item>
<a href=/golang/panic-and-recover/>
Panic and Recover
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/golang-select/ title="Golang Select" class=dd-item>
<a href=/golang/golang-select/>
Golang Select
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/addressable/ title="Addressable and Unaddressable-Value" class=dd-item>
<a href=/golang/addressable/>
Addressable and Unaddressable-Value
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/block-forever-in-go/ title="Block forever in go" class=dd-item>
<a href=/golang/block-forever-in-go/>
Block forever in go
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/channel/ title="Golang channel" class=dd-item>
<a href=/golang/channel/>
Golang channel
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/data-races/ title="Golang Data Races" class=dd-item>
<a href=/golang/data-races/>
Golang Data Races
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/log/ title=Log class=dd-item>
<a href=/golang/log/>
Log
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/sqlx/ title=Sqlx class=dd-item>
<a href=/golang/sqlx/>
Sqlx
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/struct-interface/ title="Struct Interface" class=dd-item>
<a href=/golang/struct-interface/>
Struct Interface
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/golang/type/ title=Type class=dd-item>
<a href=/golang/type/>
Type
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/algorithm/ title=Algorithm class="dd-item
parent">
<a href=/algorithm/>
<b>2. </b>Algorithm
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/algorithm/golang-search-slice/ title="Golang Search Slice" class="dd-item active">
<a href=/algorithm/golang-search-slice/>
Golang Search Slice
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/black-hat-go/ title="Black Hat Go" class=dd-item>
<a href=/black-hat-go/>
<b>3. </b>Black Hat Go
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/black-hat-go/tcp/ title=Tcp class=dd-item>
<a href=/black-hat-go/tcp/>
Tcp
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/game/ title=Game class=dd-item>
<a href=/game/>
<b>4. </b>Game
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/game/nano/ title="Nano Server" class=dd-item>
<a href=/game/nano/>
Nano Server
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/game/nano/nano-start/ title="Nano Start" class=dd-item>
<a href=/game/nano/nano-start/>
Nano Start
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/game/nano/one-nano-request/ title="One Nano Request" class=dd-item>
<a href=/game/nano/one-nano-request/>
One Nano Request
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/game/nano/nano/ title=Nano class=dd-item>
<a href=/game/nano/nano/>
Nano
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/game/nano/nano-binary-protocol/ title="Nano Binary Protocol" class=dd-item>
<a href=/game/nano/nano-binary-protocol/>
Nano Binary Protocol
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/game/combat-system/ title="Combat System" class=dd-item>
<a href=/game/combat-system/>
Combat System
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/game/game-vocabulary-list/ title="Game Vocabulary List" class=dd-item>
<a href=/game/game-vocabulary-list/>
Game Vocabulary List
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/game/turn-based-game-with-go/ title="Turn-Based Game With Go【译】" class=dd-item>
<a href=/game/turn-based-game-with-go/>
Turn-Based Game With Go【译】
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/sql/ title=Sql class=dd-item>
<a href=/sql/>
<b>5. </b>Sql
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/read/ title=Read class=dd-item>
<a href=/read/>
<b>6. </b>Read
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/read/read-vssh/ title="Read Vssh" class=dd-item>
<a href=/read/read-vssh/>
Read Vssh
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/basics/ title=Basics class=dd-item>
<a href=/basics/>
<b>X. </b>Basics
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/basics/requirements/ title=Requirements class=dd-item>
<a href=/basics/requirements/>
Requirements
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/basics/installation/ title=Installation class=dd-item>
<a href=/basics/installation/>
Installation
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/basics/configuration/ title=Configuration class=dd-item>
<a href=/basics/configuration/>
Configuration
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/basics/style-customization/ title="Style customization" class=dd-item>
<a href=/basics/style-customization/>
Style customization
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/cont/ title=Content class=dd-item>
<a href=/cont/>
<b>Y. </b>Content
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/cont/pages/ title="Pages organization" class=dd-item>
<a href=/cont/pages/>
Pages organization
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/archetypes/ title=Archetypes class=dd-item>
<a href=/cont/archetypes/>
Archetypes
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/markdown/ title="Markdown syntax" class=dd-item>
<a href=/cont/markdown/>
Markdown syntax
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/syntaxhighlight/ title="Code highlighting" class=dd-item>
<a href=/cont/syntaxhighlight/>
Code highlighting
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/menushortcuts/ title="Menu extra shortcuts" class=dd-item>
<a href=/cont/menushortcuts/>
Menu extra shortcuts
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/icons/ title="Icons and logos" class=dd-item>
<a href=/cont/icons/>
Icons and logos
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/i18n/ title="Multilingual and i18n" class=dd-item>
<a href=/cont/i18n/>
Multilingual and i18n
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/cont/tags/ title=Tags class=dd-item>
<a href=/cont/tags/>
Tags
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/shortcodes/ title=Shortcodes class=dd-item>
<a href=/shortcodes/>
<b>Z. </b>Shortcodes
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/attachments/ title=Attachments class=dd-item>
<a href=/shortcodes/attachments/>
Attachments
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/shortcodes/button/ title=Button class=dd-item>
<a href=/shortcodes/button/>
Button
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/shortcodes/children/ title=Children class=dd-item>
<a href=/shortcodes/children/>
Children
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/children/children-1/ title="page 1" class=dd-item>
<a href=/shortcodes/children/children-1/>
page 1
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/children/children-1/children-1-1/ title="page 1-1" class=dd-item>
<a href=/shortcodes/children/children-1/children-1-1/>
page 1-1
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/children/children-1/children-1-1/children-1-1-1/ title="page 1-1-1" class=dd-item>
<a href=/shortcodes/children/children-1/children-1-1/children-1-1-1/>
page 1-1-1
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/children/children-1/children-1-1/children-1-1-1/children-1-1-1-1/ title="page 1-1-1-1" class=dd-item>
<a href=/shortcodes/children/children-1/children-1-1/children-1-1-1/children-1-1-1-1/>
page 1-1-1-1
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/children/children-1/children-1-1/children-1-1-1/children-1-1-1-1/children-1-1-1-1-1/ title="page 1-1-1-1-1" class=dd-item>
<a href=/shortcodes/children/children-1/children-1-1/children-1-1-1/children-1-1-1-1/children-1-1-1-1-1/>
page 1-1-1-1-1
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li data-nav-id=/shortcodes/children/children-2/ title="page 2" class=dd-item>
<a href=/shortcodes/children/children-2/>
page 2
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/shortcodes/children/children-2/test3/ title="page test 3" class=dd-item>
<a href=/shortcodes/children/children-2/test3/>
page test 3
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/shortcodes/children/children-3/ title="page 3" class=dd-item>
<a href=/shortcodes/children/children-3/>
page 3
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/shortcodes/children/test/ title="page test" class=dd-item>
<a href=/shortcodes/children/test/>
page test
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/shortcodes/expand/ title=Expand class=dd-item>
<a href=/shortcodes/expand/>
Expand
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/shortcodes/mermaid/ title=Mermaid class=dd-item>
<a href=/shortcodes/mermaid/>
Mermaid
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/shortcodes/notice/ title=Notice class=dd-item>
<a href=/shortcodes/notice/>
Notice
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/shortcodes/siteparam/ title="Site param" class=dd-item>
<a href=/shortcodes/siteparam/>
Site param
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
</ul>
<section id=shortcuts>
<h3>More</h3>
<ul>
<li>
<a class=padding href=http://echotrue.github.io/book><i class="fas fa-solid fa-book-open"></i> Book list</a>
</li>
<li>
<a class=padding href=http://echotrue.github.io/tags><i class="fas fa-tags"></i> Tags list</a>
</li>
<li>
<a class=padding href=http://echotrue.github.io/about><i class="fas fa-fw fa-camera"></i> About me</a>
</li>
<li>
<a class=padding href=https://github.com/matcornic/hugo-theme-learn><i class="fab fa-fw fa-github"></i> GitHub repo</a>
</li>
<li>
<a class=padding href=https://gohugo.io/><i class="fas fa-fw fa-bookmark"></i> Hugo Documentation</a>
</li>
</ul>
</section>
<section id=prefooter>
<hr>
<ul>
<li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li>
</ul>
</section>
<section id=footer>
<center>
<p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p>
<p>Axlrose ©2012-<script>document.write((new Date).getFullYear())</script></p>
</center>
<script async defer src=https://buttons.github.io/buttons.js></script>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=/>Axlrose</a> > <a href=/algorithm/>Algorithm</a> > Golang Search Slice
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li><a href=#题目>题目</a>
<ul>
<li><a href=#解法>解法</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
<div class=tags>
<a class=tag-link href=/tags/go>Go</a>
<a class=tag-link href=/tags/slice>Slice</a>
</div>
</div>
<div id=body-inner>
<h1>
Golang Search Slice
</h1>
<h2 id=题目>题目</h2>
<blockquote>
<p>假设有一个超长的切片，切片的元素类型为int，切片中的元素为乱序排列。限时5秒，使用多个goroutine查找切片中是否存在给定值，
在找到目标值或者超时后立刻结束所有goroutine的执行。比如切片为：[23, 32, 78, 43, 76, 65, 345, 762, …… 915, 86]，
查找的目标值为345，如果切片中存在目标值程序输出:&ldquo;Found it!&ldquo;并且立即取消仍在执行查找任务的goroutine。如果在超时时间未
找到目标值程序输出:&ldquo;Timeout! Not Found&rdquo;，同时立即取消仍在执行查找任务的goroutine。</p>
</blockquote>
<p>首先题目里提到了在找到目标值或者超时后立刻结束所有<code>goroutine</code>的执行，完成这两个功能需要借助计时器、通道和<code>context</code>才行。
我能想到的第一点就是要用<code>context.WithCancel</code>创建一个上下文对象传递给每个执行任务的<code>goroutine</code>，外部在满足条件后（找到目标值或者已超时）
通过调用上下文的取消函数来通知所有<code>goroutine</code>停止工作。</p>
<h3 id=解法>解法</h3>
<pre tabindex=0><code>package main

import (
	&quot;context&quot;
	&quot;fmt&quot;
	&quot;os&quot;
	&quot;time&quot;
)

func main() {
    timer := time.NewTimer(time.Second * 5)
    data := []int{1, 2, 3, 10, 999, 8, 345, 7, 98, 33, 66, 77, 88, 68, 96}
    dataLen := len(data)
    size := 3
    target := 345
    ctx, cancel := context.WithCancel(context.Background())
    resultChan := make(chan bool)
    for i := 0; i &lt; dataLen; i += size {
        end := i + size
        if end &gt;= dataLen {
            end = dataLen - 1
        }
        go SearchTarget(ctx, data[i:end], target, resultChan)
    }
    select {
    case &lt;-timer.C:
        fmt.Fprintln(os.Stderr, &quot;Timeout! Not Found&quot;)
        cancel()
    case &lt;-resultChan:
        fmt.Fprintf(os.Stdout, &quot;Found it!\n&quot;)
        cancel()
    }
    
    time.Sleep(time.Second * 2)
}

func SearchTarget(ctx context.Context, data []int, target int, resultChan chan bool) {
    for _, v := range data {
        select {
        case &lt;-ctx.Done():
            fmt.Fprintf(os.Stdout, &quot;Task cancelded! \n&quot;)
            return
        default:
        }
        // 模拟一个耗时查找，这里只是比对值，真实开发中可以是其他操作
        fmt.Fprintf(os.Stdout, &quot;v: %d \n&quot;, v)
        time.Sleep(time.Millisecond * 1500)
        if target == v {
            resultChan &lt;- true
            return
        }
    }
}

</code></pre>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
<a class="nav nav-prev" href=/algorithm/ title=Algorithm> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/black-hat-go/ title="Black Hat Go" style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/js/clipboard.min.js?1698402356></script>
<script src=/js/perfect-scrollbar.min.js?1698402356></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1698402356></script>
<script src=/js/jquery.sticky.js?1698402356></script>
<script src=/js/featherlight.min.js?1698402356></script>
<script src=/js/highlight.pack.js?1698402356></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=/js/modernizr.custom-3.6.0.js?1698402356></script>
<script src=/js/learn.js?1698402356></script>
<script src=/js/hugo-learn.js?1698402356></script>
<script src=/mermaid/mermaid.js?1698402356></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-105947713-1','auto'),ga('send','pageview')</script>
</body>
</html>