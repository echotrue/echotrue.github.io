<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Nano Start</title>
<meta charset=utf-8><meta name=description content="Ladder@基础概念 一个nano应用程序由各个不同粒度的单元组成，这其中涉及到一些基础概念。例如：node,cluster,component,serv"><meta name=author content="Axlrose"><link rel=canonical href=https://echotrue.github.io/blog/game/nano/nano-start/><link rel=alternate type=application/rss+xml href=https://echotrue.github.io//index.xml title=AXLROSE><meta property="og:url" content="https://echotrue.github.io/blog/game/nano/nano-start/"><meta property="og:site_name" content="AXLROSE"><meta property="og:title" content="Nano Start"><meta property="og:description" content="基础概念 一个nano应用程序由各个不同粒度的单元组成，这其中涉及到一些基础概念。例如：node,cluster,component,serv"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-08-31T16:54:27+08:00"><meta property="article:modified_time" content="2021-08-31T16:54:27+08:00"><meta property="article:tag" content="Nano"><meta property="og:see_also" content="https://echotrue.github.io/blog/game/nano/one-nano-request/"><meta property="og:see_also" content="https://echotrue.github.io/blog/game/nano/nano-binary-protocol/"><meta property="og:see_also" content="https://echotrue.github.io/blog/game/nano/nano/"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://echotrue.github.io/blog/"},{"@type":"ListItem","position":2,"name":"Nano Start","item":"https://echotrue.github.io/blog/game/nano/nano-start/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nano Start","name":"Nano Start","description":"基础概念 一个nano应用程序由各个不同粒度的单元组成，这其中涉及到一些基础概念。例如：node,cluster,component,serv","keywords":["nano"],"articleBody":"基础概念 一个nano应用程序由各个不同粒度的单元组成，这其中涉及到一些基础概念。例如：node,cluster,component,service,handler等等。这里简单介绍各个单元的概念，并概述他们之间的关系。\nCluster cluster表示一个nano的集群，这个集群包含一组节点，每一个节点提供一组不同的服务，所有从客户端发送的服务请求首先会被发送到gate网关，然后被发送到响应的节点\ntype cluster struct { // If cluster is not large enough, use slice is OK currentNode *Node //当前节点对象 rpcClient *rpcClient // rpc客户端用于和其他节点通信 mu sync.RWMutex members []*Member //所有的节点成员，member包含了节点地址，节点下的服务，是否是主节点 } Node是nano集群中的一个节点，该节点提供一组服务，所有这些服务都会注册到集群。消息将会被转发到提供各自服务的节点。\ntype Node struct { Options // 节点配置项 ServiceAddr string // 当前节点的服务地址，主要用于RPC通信 cluster *cluster //集群对象 handler *LocalHandler //节点本地处理程序 server *grpc.Server //grpc 服务器 rpcClient *rpcClient //rpc 客户端用于和其他节点通信 mu sync.RWMutex sessions map[int64]*session.Session //会话列表 } Node.Options\ntype Options struct { Pipeline pipeline.Pipeline IsMaster bool AdvertiseAddr string RetryInterval time.Duration ClientAddr string Components *component.Components Label string IsWebsocket bool TSLCertificate string TSLKey string } Start Node 初始化配置 设置集群的Options选项。其中Options.Components类型定义了一个组件切片comps，这个切片的类型是CompWithOptions，其中Comp是组件，Opts是该组件的属性。 // Options.Components type Components struct { comps []CompWithOptions } type CompWithOptions struct { Comp Component Opts []Option } 而这些Comp组件则是实现了各种逻辑的单个服务。并且这些组件必须实现Component接口。\n初始化节点属性 初始化Node的属性：session用来保存客户端会话,cluster是nano集群,handler存储了本地及远程服务.结构如下： type cluster struct { // If cluster is not large enough, use slice is OK currentNode *Node rpcClient *rpcClient mu sync.RWMutex members []*Member } type LocalHandler struct { localServices map[string]*component.Service // all registered service localHandlers map[string]*component.Handler // all handler method mu sync.RWMutex remoteServices map[string][]*clusterpb.MemberInfo pipeline pipeline.Pipeline currentNode *Node } install service and handler 接下来将上面组件切片中组件依次注册到节点的handle中。这里的组件被定义为Service类型，组件中的方法被定义为Handler类型。Service实现了一个特定服务，该服务下的方法将在对应事件触发是被调用。\ntype Service struct { Name string // 服务名称 Type reflect.Type // 接收者类型 Receiver reflect.Value // 服务下方法的接收者 Handlers map[string]*Handler // 注册的方法 SchedName string // name of scheduler variable in session data Options options // 选项 } type Handler struct { Receiver reflect.Value // receiver of method Method reflect.Method // method stub Type reflect.Type // low-level type of method IsRawArg bool // whether the data need to serialize } 注册服务及服务下func部分代码：\nfunc (h *LocalHandler) register(comp component.Component, opts []component.Option) error { s := component.NewService(comp, opts) if _, ok := h.localServices[s.Name]; ok { return fmt.Errorf(\"handler: service already defined: %s\", s.Name) } if err := s.ExtractHandler(); err != nil { return err } // register all localHandlers h.localServices[s.Name] = s for name, handler := range s.Handlers { n := fmt.Sprintf(\"%s.%s\", s.Name, name) log.Println(\"Register local handler\", n) h.localHandlers[n] = handler } return nil } 根据组件名初始化一个component.Service对象作为value，以组件的名称作为key，赋值给localHandler.localServices. ExtractHandler检测组件及组件下方法是否导出。并将组件下的方法注册到component.Service.Handlers.接下来再将这些组件方法注册到localHandler.localHandlers.\ncache()定义了握手响应数据和心跳包数据\ninitNode init gRPC and register service n.server = grpc.NewServer()创建一个gRPC服务器。此时该服务器上没有注册任何服务，也没有开始接收请求。\nclusterpb.RegisterMemberServer(n.server, n)向gRPC注册MemberServer服务。MemberServer服务包含了一些列API,而节点n实现了MemberServer接口。因此所有启动的节点均提供这些API服务。\ntype MemberServer interface { HandleRequest(context.Context, *RequestMessage) (*MemberHandleResponse, error) HandleNotify(context.Context, *NotifyMessage) (*MemberHandleResponse, error) HandlePush(context.Context, *PushMessage) (*MemberHandleResponse, error) HandleResponse(context.Context, *ResponseMessage) (*MemberHandleResponse, error) NewMember(context.Context, *NewMemberRequest) (*NewMemberResponse, error) DelMember(context.Context, *DelMemberRequest) (*DelMemberResponse, error) SessionClosed(context.Context, *SessionClosedRequest) (*SessionClosedResponse, error) CloseSession(context.Context, *CloseSessionRequest) (*CloseSessionResponse, error) } 开辟一个goroutine开始监听n.ServiceAddr并开始接收rpc请求。\nn.rpcClient = newRPCClient()初始化当前节点的rpc客户端对象。\nclusterpb.RegisterMemberServer(n.server, n)，将当前Node实现了MemberServer的服务注册到gRPC服务器。\n如果当前是主服务器Master,clusterpb.RegisterMasterServer(n.server, n.cluster)向服务器注册服务实现。n.cluster实现了Master接口的Register和Unregister两个API。当其他节点启动时会将其所有的服务通过Register注册到Master主节点。这里的member描述集群的一个成员，即节点。将节点作为成员添加到集群，设置集群rpcClient.\n如果当前不是主服务器节点，根据主服务器Master的RPC地址node.AdvertiseAddr创建连接池，并获取连接。然后创建gRPC客户端。将当前节点成员信息通过主服务器的Register服务发送到集群的主服务器Master.主服务器节点的cluster.Register()接收注册请求,然后将新加入的节点成员信息通过NewMember事件发送到各个非Master节点，并将新加的节点成员信息添加到集群的成员列表，同时将新加节点成员中的所有服务添加到集群的handle中。并响应此时集群中所有服务给新节点。当前节点拿到集群中所有其他成员信息后，首先将这些远程的服务添加到当前节点handler的远程服务列表中。然后将这些远程节点成员添加到当前节点的集群的成员列表中\n因此，Master主服务器节点上注册了MemberServer和MasterServer两组服务。而非Master节点服务器上只注册了MemberServer一组服务。详见Node实现的服务列表和Cluster实现的服务列表\nInitialize all components 依次执行当前节点下所有组件的Init()和AfterInit()两个生命周期函数\nListen client address 如果设置了node.ClientAddr地址，则开始监听并接收请求。node.ClientAddr是暴露给外部供外部访问的地址。\nNode实现的服务列表 type MemberServer interface { HandleRequest(context.Context, *RequestMessage) (*MemberHandleResponse, error) HandleNotify(context.Context, *NotifyMessage) (*MemberHandleResponse, error) HandlePush(context.Context, *PushMessage) (*MemberHandleResponse, error) HandleResponse(context.Context, *ResponseMessage) (*MemberHandleResponse, error) NewMember(context.Context, *NewMemberRequest) (*NewMemberResponse, error) DelMember(context.Context, *DelMemberRequest) (*DelMemberResponse, error) SessionClosed(context.Context, *SessionClosedRequest) (*SessionClosedResponse, error) CloseSession(context.Context, *CloseSessionRequest) (*CloseSessionResponse, error) } Cluster实现的服务列表 type MasterServer interface { Register(context.Context, *RegisterRequest) (*RegisterResponse, error) Unregister(context.Context, *UnregisterRequest) (*UnregisterResponse, error) } ","wordCount":"2380","inLanguage":"en","datePublished":"2021-08-31T16:54:27+08:00","dateModified":"2021-08-31T16:54:27+08:00","author":{"@type":"Person","name":"Axlrose"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://echotrue.github.io/blog/game/nano/nano-start/"},"publisher":{"@type":"Organization","name":"AXLROSE","logo":{"@type":"ImageObject","url":"https://echotrue.github.io/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css><link rel=stylesheet href=/css/main.min.e196d9ab5d83e9373fc94cbe17793a8f1224c1f72b4e871fd98ddad7d3f29fec.css integrity="sha256-4ZbZq12D6Tc/yUy+F3k6jxIkwfcrTocf2Y3a19Pyn+w=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/atom-one-dark.min.d51fd0897056947c1a907d5753da4b37e67f6c13b4ec4c836708e028a1b5687a.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/blog>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/series>Series</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/book>Book</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Nano Start</h1></header><p><small>August 31, 2021&nbsp;· 2380 words&nbsp;· 5 min</small>
<small>·
<a href=https://echotrue.github.io/tags/nano/>Nano</a></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#基础概念>基础概念</a><ul><li><a href=#cluster>Cluster</a></li></ul></li><li><a href=#start-node>Start Node</a><ul><li><a href=#install-service-and-handler>install service and handler</a></li><li><a href=#initnode>initNode</a></li><li><a href=#initialize-all-components>Initialize all components</a></li><li><a href=#listen-client-address>Listen client address</a></li><li><a href=#node实现的服务列表>Node实现的服务列表</a></li><li><a href=#cluster实现的服务列表>Cluster实现的服务列表</a></li></ul></li></ul></nav></div><section class=blog-content><h2 id=基础概念>基础概念</h2><p>一个<code>nano</code>应用程序由各个不同粒度的单元组成，这其中涉及到一些基础概念。例如：<code>node</code>,<code>cluster</code>,<code>component</code>,<code>service</code>,<code>handler</code>等等。这里简单介绍各个单元的概念，并概述他们之间的关系。</p><h3 id=cluster>Cluster</h3><p><code>cluster</code>表示一个<code>nano</code>的集群，这个集群包含一组节点，每一个节点提供一组不同的服务，所有从客户端发送的服务请求首先会被发送到<code>gate</code>网关，然后被发送到响应的节点</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>cluster</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If cluster is not large enough, use slice is OK 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>currentNode</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Node</span>  <span style=color:#75715e>//当前节点对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>rpcClient</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>rpcClient</span>  <span style=color:#75715e>// rpc客户端用于和其他节点通信
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>members</span> []<span style=color:#f92672>*</span><span style=color:#a6e22e>Member</span>  <span style=color:#75715e>//所有的节点成员，member包含了节点地址，节点下的服务，是否是主节点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p><code>Node</code>是<code>nano</code>集群中的一个节点，该节点提供一组服务，所有这些服务都会注册到集群。消息将会被转发到提供各自服务的节点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Node</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Options</span> <span style=color:#75715e>// 节点配置项  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>ServiceAddr</span> <span style=color:#66d9ef>string</span> <span style=color:#75715e>// 当前节点的服务地址，主要用于RPC通信 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span> <span style=color:#a6e22e>cluster</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>cluster</span>  <span style=color:#75715e>//集群对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LocalHandler</span> <span style=color:#75715e>//节点本地处理程序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Server</span>  <span style=color:#75715e>//grpc 服务器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>rpcClient</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>rpcClient</span>  <span style=color:#75715e>//rpc 客户端用于和其他节点通信
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span> <span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>  
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sessions</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>int64</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>Session</span>  <span style=color:#75715e>//会话列表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p><code>Node.Options</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Options</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Pipeline</span> <span style=color:#a6e22e>pipeline</span>.<span style=color:#a6e22e>Pipeline</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>IsMaster</span> <span style=color:#66d9ef>bool</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>AdvertiseAddr</span> <span style=color:#66d9ef>string</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RetryInterval</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ClientAddr</span> <span style=color:#66d9ef>string</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Components</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>Components</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Label</span> <span style=color:#66d9ef>string</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>IsWebsocket</span> <span style=color:#66d9ef>bool</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>TSLCertificate</span> <span style=color:#66d9ef>string</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>TSLKey</span> <span style=color:#66d9ef>string</span>  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=start-node>Start Node</h2><ul><li>初始化配置
设置集群的<code>Options</code>选项。其中<code>Options.Components</code>类型定义了一个组件切片<code>comps</code>，这个切片的类型是<code>CompWithOptions</code>，其中<code>Comp</code>是组件，<code>Opts</code>是该组件的属性。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#75715e>// Options.Components
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Components</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>comps</span> []<span style=color:#a6e22e>CompWithOptions</span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CompWithOptions</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Comp</span> <span style=color:#a6e22e>Component</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Opts</span> []<span style=color:#a6e22e>Option</span>  
</span></span><span style=display:flex><span>}    
</span></span></code></pre></div><p>而这些<code>Comp</code>组件则是实现了各种逻辑的单个服务。并且这些组件必须实现<code>Component</code>接口。</p><ul><li>初始化节点属性
初始化<code>Node</code>的属性：<code>session</code>用来保存客户端会话,<code>cluster</code>是nano集群,<code>handler</code>存储了本地及远程服务.结构如下：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>cluster</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If cluster is not large enough, use slice is OK currentNode *Node  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>rpcClient</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>rpcClient</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>members</span> []<span style=color:#f92672>*</span><span style=color:#a6e22e>Member</span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>LocalHandler</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>localServices</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>Service</span> <span style=color:#75715e>// all registered service  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>localHandlers</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>Handler</span> <span style=color:#75715e>// all handler method  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>remoteServices</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>][]<span style=color:#f92672>*</span><span style=color:#a6e22e>clusterpb</span>.<span style=color:#a6e22e>MemberInfo</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pipeline</span> <span style=color:#a6e22e>pipeline</span>.<span style=color:#a6e22e>Pipeline</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>currentNode</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Node</span>  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=install-service-and-handler>install service and handler</h3><p>接下来将上面组件切片中组件依次注册到节点的handle中。这里的组件被定义为<code>Service</code>类型，组件中的方法被定义为<code>Handler</code>类型。<code>Service</code>实现了一个特定服务，该服务下的方法将在对应事件触发是被调用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Service</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#75715e>// 服务名称 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Type</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span> <span style=color:#75715e>// 接收者类型  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Receiver</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Value</span> <span style=color:#75715e>// 服务下方法的接收者 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Handlers</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>Handler</span> <span style=color:#75715e>// 注册的方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>SchedName</span> <span style=color:#66d9ef>string</span> <span style=color:#75715e>// name of scheduler variable in session data  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Options</span> <span style=color:#a6e22e>options</span> <span style=color:#75715e>// 选项  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Handler</span> <span style=color:#66d9ef>struct</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Receiver</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Value</span> <span style=color:#75715e>// receiver of method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Method</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Method</span> <span style=color:#75715e>// method stub  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Type</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span> <span style=color:#75715e>// low-level type of method  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>IsRawArg</span> <span style=color:#66d9ef>bool</span> <span style=color:#75715e>// whether the data need to serialize  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>注册服务及服务下func部分代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LocalHandler</span>) <span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>comp</span> <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>opts</span> []<span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>Option</span>) <span style=color:#66d9ef>error</span> {  
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>NewService</span>(<span style=color:#a6e22e>comp</span>, <span style=color:#a6e22e>opts</span>)  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>localServices</span>[<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Name</span>]; <span style=color:#a6e22e>ok</span> {  
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;handler: service already defined: %s&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Name</span>)  
</span></span><span style=display:flex><span>	 }  
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>ExtractHandler</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {  
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>  
</span></span><span style=display:flex><span>	 }  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	 <span style=color:#75715e>// register all localHandlers  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	 <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>localServices</span>[<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Name</span>] = <span style=color:#a6e22e>s</span>  
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>handler</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Handlers</span> {  
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s.%s&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>name</span>)  
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Register local handler&#34;</span>, <span style=color:#a6e22e>n</span>)  
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>localHandlers</span>[<span style=color:#a6e22e>n</span>] = <span style=color:#a6e22e>handler</span>  
</span></span><span style=display:flex><span>	 }  
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>根据组件名初始化一个<code>component.Service</code>对象作为<code>value</code>，以组件的名称作为<code>key</code>，赋值给<code>localHandler.localServices</code>.
<code>ExtractHandler</code>检测组件及组件下方法是否导出。并将组件下的方法注册到<code>component.Service.Handlers</code>.接下来再将这些组件方法注册到<code>localHandler.localHandlers</code>.</p><p><code>cache()</code>定义了握手响应数据和心跳包数据</p><h3 id=initnode>initNode</h3><h4 id=init-grpc-and-register-service>init gRPC and register service</h4><p><code>n.server = grpc.NewServer()</code>创建一个<code>gRPC</code>服务器。此时该服务器上没有注册任何服务，也没有开始接收请求。</p><p><code>clusterpb.RegisterMemberServer(n.server, n)</code>向<code>gRPC</code>注册<code>MemberServer</code>服务。<code>MemberServer</code>服务包含了一些列<code>API</code>,而节点<code>n</code>实现了<code>MemberServer</code>接口。因此所有启动的节点均提供这些<code>API</code>服务。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MemberServer</span> <span style=color:#66d9ef>interface</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandleRequest</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>RequestMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandleNotify</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>NotifyMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandlePush</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>PushMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandleResponse</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>ResponseMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>NewMember</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>NewMemberRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>NewMemberResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DelMember</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>DelMemberRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>DelMemberResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SessionClosed</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>SessionClosedRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>SessionClosedResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CloseSession</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>CloseSessionRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>CloseSessionResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>开辟一个<code>goroutine</code>开始监听<code>n.ServiceAddr</code>并开始接收<code>rpc</code>请求。</p><p><code>n.rpcClient = newRPCClient()</code>初始化当前节点的<code>rpc</code>客户端对象。</p><p><code>clusterpb.RegisterMemberServer(n.server, n)</code>，将当前Node实现了<code>MemberServer</code>的服务注册到<code>gRPC</code>服务器。</p><ul><li><p>如果当前是主服务器<code>Master</code>,<code>clusterpb.RegisterMasterServer(n.server, n.cluster)</code>向服务器注册服务实现。<code>n.cluster</code>实现了<code>Master</code>接口的<code>Register</code>和<code>Unregister</code>两个API。当其他节点启动时会将其所有的服务通过<code>Register</code>注册到Master主节点。这里的<code>member</code>描述集群的一个成员，即节点。将节点作为成员添加到集群，设置集群<code>rpcClient</code>.</p></li><li><p>如果当前不是主服务器节点，根据主服务器Master的RPC地址<code>node.AdvertiseAddr</code>创建连接池，并获取连接。然后创建gRPC客户端。将当前节点成员信息通过主服务器的<code>Register</code>服务发送到集群的主服务器<code>Master</code>.主服务器节点的<code>cluster.Register()</code>接收注册请求,然后将新加入的节点成员信息通过<code>NewMember</code>事件发送到各个非Master节点，并将新加的节点成员信息添加到集群的成员列表，同时将新加节点成员中的所有服务添加到集群的<code>handle</code>中。并响应此时集群中所有服务给新节点。当前节点拿到集群中所有其他成员信息后，首先将这些远程的服务添加到当前节点<code>handler</code>的远程服务列表中。然后将这些远程节点成员添加到当前节点的集群的成员列表中</p></li></ul><p>因此，Master主服务器节点上注册了<code>MemberServer</code>和<code>MasterServer</code>两组服务。而非Master节点服务器上只注册了<code>MemberServer</code>一组服务。详见<a href=#node%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8>Node实现的服务列表</a>和<a href=#cluster%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8>Cluster实现的服务列表</a></p><h3 id=initialize-all-components>Initialize all components</h3><p>依次执行当前节点下所有组件的<code>Init()</code>和<code>AfterInit()</code>两个生命周期函数</p><h3 id=listen-client-address>Listen client address</h3><p>如果设置了<code>node.ClientAddr</code>地址，则开始监听并接收请求。<code>node.ClientAddr</code>是暴露给外部供外部访问的地址。</p><h3 id=node实现的服务列表>Node实现的服务列表</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MemberServer</span> <span style=color:#66d9ef>interface</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandleRequest</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>RequestMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandleNotify</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>NotifyMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandlePush</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>PushMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HandleResponse</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>ResponseMessage</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>MemberHandleResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>NewMember</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>NewMemberRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>NewMemberResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DelMember</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>DelMemberRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>DelMemberResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SessionClosed</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>SessionClosedRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>SessionClosedResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CloseSession</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>CloseSessionRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>CloseSessionResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=cluster实现的服务列表>Cluster实现的服务列表</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MasterServer</span> <span style=color:#66d9ef>interface</span> {  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Register</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>RegisterRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>RegisterResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Unregister</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>UnregisterRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>UnregisterResponse</span>, <span style=color:#66d9ef>error</span>)  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><div class=paginator><a class=prev href=https://echotrue.github.io/blog/game/nano/one-nano-request/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>One Nano Request</span></a>
<a class=next href=https://echotrue.github.io/blog/golang/binary-an-bit-operation/><span>Binary an Bit Operation</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div><div class=related-resources><h3>Related Resources</h3><nav><ul><li><a href=/blog/game/nano/one-nano-request/>One Nano Request</a></li><li><a href=/blog/game/nano/nano-binary-protocol/>Nano Binary Protocol</a></li><li><a href=/blog/game/nano/nano/>Nano</a></li></ul></nav></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://echotrue.github.io/>AXLROSE</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
Theme by
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>