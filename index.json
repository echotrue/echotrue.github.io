[
{
	"uri": "http://echotrue.github.io/golang/",
	"title": "Golang",
	"tags": [],
	"description": "",
	"content": "Chapter 1 Blog articles \rContext\r\r\rArray And Slice\r\r\rUint Int\r\r\rFunctional Programming in Golang\r\r\rBinary an Bit Operation\r\r\rLock\r\r\rGolang make and new\r\r\rPanic and Recover\r\r\rGolang Select\r\r\rAddressable and Unaddressable-Value\r\r\rBlock forever in go\r\r\rGolang channel\r\r\rGolang Data Races\r\r\rLog\r\r\rSqlx\r\r\r"
},
{
	"uri": "http://echotrue.github.io/game/nano/",
	"title": "Nano Server",
	"tags": [],
	"description": "Nano Notes",
	"content": "Chapter 4-1 Nano Server \rNano Start\r\r\rOne Nano Request\r\r\rNano\r\r\rNano Binary Protocol\r\r\r"
},
{
	"uri": "http://echotrue.github.io/game/nano/nano-start/",
	"title": "Nano Start",
	"tags": [],
	"description": "",
	"content": "基础概念 一个nano应用程序由各个不同粒度的单元组成，这其中涉及到一些基础概念。例如：node,cluster,component,service,handler等等。这里简单介绍各个单元的概念，并概述他们之间的关系。\nCluster cluster表示一个nano的集群，这个集群包含一组节点，每一个节点提供一组不同的服务，所有从客户端发送的服务请求首先会被发送到gate网关，然后被发送到响应的节点\ntype cluster struct { // If cluster is not large enough, use slice is OK \tcurrentNode *Node //当前节点对象 \trpcClient *rpcClient // rpc客户端用于和其他节点通信  mu sync.RWMutex members []*Member //所有的节点成员，member包含了节点地址，节点下的服务，是否是主节点 } Node是nano集群中的一个节点，该节点提供一组服务，所有这些服务都会注册到集群。消息将会被转发到提供各自服务的节点。\ntype Node struct { Options // 节点配置项  ServiceAddr string // 当前节点的服务地址，主要用于RPC通信  cluster *cluster //集群对象  handler *LocalHandler //节点本地处理程序  server *grpc.Server //grpc 服务器  rpcClient *rpcClient //rpc 客户端用于和其他节点通信  mu sync.RWMutex sessions map[int64]*session.Session //会话列表 } Node.Options\ntype Options struct { Pipeline pipeline.Pipeline IsMaster bool AdvertiseAddr string RetryInterval time.Duration ClientAddr string Components *component.Components Label string IsWebsocket bool TSLCertificate string TSLKey string } Start Node  初始化配置 设置集群的Options选项。其中Options.Components类型定义了一个组件切片comps，这个切片的类型是CompWithOptions，其中Comp是组件，Opts是该组件的属性。  // Options.Components  type Components struct { comps []CompWithOptions } type CompWithOptions struct { Comp Component Opts []Option } 而这些Comp组件则是实现了各种逻辑的单个服务。并且这些组件必须实现Component接口。\n 初始化节点属性 初始化Node的属性：session用来保存客户端会话,cluster是nano集群,handler存储了本地及远程服务.结构如下：  type cluster struct { // If cluster is not large enough, use slice is OK currentNode *Node \trpcClient *rpcClient mu sync.RWMutex members []*Member } type LocalHandler struct { localServices map[string]*component.Service // all registered service \tlocalHandlers map[string]*component.Handler // all handler method  mu sync.RWMutex remoteServices map[string][]*clusterpb.MemberInfo pipeline pipeline.Pipeline currentNode *Node } install service and handler 接下来将上面组件切片中组件依次注册到节点的handle中。这里的组件被定义为Service类型，组件中的方法被定义为Handler类型。Service实现了一个特定服务，该服务下的方法将在对应事件触发是被调用。\ntype Service struct { Name string // 服务名称 \tType reflect.Type // 接收者类型 \tReceiver reflect.Value // 服务下方法的接收者 \tHandlers map[string]*Handler // 注册的方法 \tSchedName string // name of scheduler variable in session data \tOptions options // 选项 } type Handler struct { Receiver reflect.Value // receiver of method \tMethod reflect.Method // method stub \tType reflect.Type // low-level type of method \tIsRawArg bool // whether the data need to serialize } 注册服务及服务下func部分代码：\nfunc (h *LocalHandler) register(comp component.Component, opts []component.Option) error { s := component.NewService(comp, opts) if _, ok := h.localServices[s.Name]; ok { return fmt.Errorf(\u0026#34;handler: service already defined: %s\u0026#34;, s.Name) } if err := s.ExtractHandler(); err != nil { return err } // register all localHandlers \th.localServices[s.Name] = s for name, handler := range s.Handlers { n := fmt.Sprintf(\u0026#34;%s.%s\u0026#34;, s.Name, name) log.Println(\u0026#34;Register local handler\u0026#34;, n) h.localHandlers[n] = handler } return nil } 根据组件名初始化一个component.Service对象作为value，以组件的名称作为key，赋值给localHandler.localServices. ExtractHandler检测组件及组件下方法是否导出。并将组件下的方法注册到component.Service.Handlers.接下来再将这些组件方法注册到localHandler.localHandlers.\ncache()定义了握手响应数据和心跳包数据\ninitNode init gRPC and register service n.server = grpc.NewServer()创建一个gRPC服务器。此时该服务器上没有注册任何服务，也没有开始接收请求。\nclusterpb.RegisterMemberServer(n.server, n)向gRPC注册MemberServer服务。MemberServer服务包含了一些列API,而节点n实现了MemberServer接口。因此所有启动的节点均提供这些API服务。\ntype MemberServer interface { HandleRequest(context.Context, *RequestMessage) (*MemberHandleResponse, error) HandleNotify(context.Context, *NotifyMessage) (*MemberHandleResponse, error) HandlePush(context.Context, *PushMessage) (*MemberHandleResponse, error) HandleResponse(context.Context, *ResponseMessage) (*MemberHandleResponse, error) NewMember(context.Context, *NewMemberRequest) (*NewMemberResponse, error) DelMember(context.Context, *DelMemberRequest) (*DelMemberResponse, error) SessionClosed(context.Context, *SessionClosedRequest) (*SessionClosedResponse, error) CloseSession(context.Context, *CloseSessionRequest) (*CloseSessionResponse, error) } 开辟一个goroutine开始监听n.ServiceAddr并开始接收rpc请求。\nn.rpcClient = newRPCClient()初始化当前节点的rpc客户端对象。\nclusterpb.RegisterMemberServer(n.server, n)，将当前Node实现了MemberServer的服务注册到gRPC服务器。\n  如果当前是主服务器Master,clusterpb.RegisterMasterServer(n.server, n.cluster)向服务器注册服务实现。n.cluster实现了Master接口的Register和Unregister两个API。当其他节点启动时会将其所有的服务通过Register注册到Master主节点。这里的member描述集群的一个成员，即节点。将节点作为成员添加到集群，设置集群rpcClient.\n  如果当前不是主服务器节点，根据主服务器Master的RPC地址node.AdvertiseAddr创建连接池，并获取连接。然后创建gRPC客户端。将当前节点成员信息通过主服务器的Register服务发送到集群的主服务器Master.主服务器节点的cluster.Register()接收注册请求,然后将新加入的节点成员信息通过NewMember事件发送到各个非Master节点，并将新加的节点成员信息添加到集群的成员列表，同时将新加节点成员中的所有服务添加到集群的handle中。并响应此时集群中所有服务给新节点。当前节点拿到集群中所有其他成员信息后，首先将这些远程的服务添加到当前节点handler的远程服务列表中。然后将这些远程节点成员添加到当前节点的集群的成员列表中\n  因此，Master主服务器节点上注册了MemberServer和MasterServer两组服务。而非Master节点服务器上只注册了MemberServer一组服务。详见Node实现的服务列表和Cluster实现的服务列表\nInitialize all components 依次执行当前节点下所有组件的Init()和AfterInit()两个生命周期函数\nListen client address 如果设置了node.ClientAddr地址，则开始监听并接收请求。node.ClientAddr是暴露给外部供外部访问的地址。\nNode实现的服务列表 type MemberServer interface { HandleRequest(context.Context, *RequestMessage) (*MemberHandleResponse, error) HandleNotify(context.Context, *NotifyMessage) (*MemberHandleResponse, error) HandlePush(context.Context, *PushMessage) (*MemberHandleResponse, error) HandleResponse(context.Context, *ResponseMessage) (*MemberHandleResponse, error) NewMember(context.Context, *NewMemberRequest) (*NewMemberResponse, error) DelMember(context.Context, *DelMemberRequest) (*DelMemberResponse, error) SessionClosed(context.Context, *SessionClosedRequest) (*SessionClosedResponse, error) CloseSession(context.Context, *CloseSessionRequest) (*CloseSessionResponse, error) } Cluster实现的服务列表 type MasterServer interface { Register(context.Context, *RegisterRequest) (*RegisterResponse, error) Unregister(context.Context, *UnregisterRequest) (*UnregisterResponse, error) } "
},
{
	"uri": "http://echotrue.github.io/golang/context/",
	"title": "Context",
	"tags": ["Go", "context", "上下文"],
	"description": "",
	"content": "引言 Golang的Context包是专门用来简化对于处理单个请求的多个goroutine之间与请求域的数据，取消信号，截止时间等相关操作。 一个实际的例子是：\n 在Go服务器程序中，每个请求都会有一个goroutine去处理。然而，处理程序可能还需要创建额外的goroutine去访问其他资源，比如：数据库， RPC服务等。由于这些goroutine都是在处理同一个请求，所以他们往往需要访问一些共享的资源，比如：用户身份信息，认证token ，请求截止时间等。当请求超时或者被取消后，所有的goroutine都应该马上退出并且释放相关的资源。这种情况也需要用Context来为我们来取消掉所有 的goroutine\n Context定义 context的主要数据结构是一种嵌套的结构或者说是单向的继承关系的结构，比如最初的context是一个小盒子，里面装了一些数据， 之后从这个context继承下来的children就像在原本的context中又套上了一个盒子，然后里面装着一些自己的数据。或者说context是一种分层的结构， 根据使用场景的不同，每一层context都具备有一些不同的特性，这种层级式的组织也使得context易于扩展，职责清晰。\ncontext包的核心是interface Context ,声明如下：\ntype Context interface { Deadline() (deadline time.Time, ok bool) Done() \u0026lt;-chan struct{} Err() error Value(key interface{}) interface{} } Context定义很简单，一共四个方法：\n Deadline方法是获取设置的截止时间的意思，第一个返回式是截止时间，到了这个时间点，Context会自动发起取消请求； 第二个返回值ok==false时表示没有设置截止时间，如果需要取消的话，需要调用取消函数进行取消。 Done方法返回一个只读的chan，类型为struct{}，我们在goroutine中，如果该方法返回的chan可以读取， 则意味着parent context已经发起了取消请求，我们通过Done方法收到这个信号后，就应该做清理操作，然后退出goroutine，释放资源。之后，Err 方法会返回一个错误，告知为什么 Context 被取消。 Err方法返回取消的错误原因，因为什么Context被取消。 Value方法获取该Context上绑定的值，是一个键值对，所以要通过一个Key才可以获取对应的值，这个值一般是线程安全的。  Context的实现方法 Context 虽然是个接口，但是并不需要使用方实现，golang内置的context 包，已经帮我们实现了2个方法，一般在代码中， 开始上下文的时候都是以这两个作为最顶层的parent context，然后再衍生出子context。这些 Context 对象形成一棵树： 当一个 Context 对象被取消时，继承自它的所有 Context 都会被取消。两个实现如下：\nvar ( background = new(emptyCtx) todo = new(emptyCtx) ) func Background() Context { return background } func TODO() Context { return todo }  一个是Background，主要用于main函数、初始化以及测试代码中，作为Context这个树结构的最顶层的Context，也就是根Context，它不能被取消。 一个是TODO，如果我们不知道该使用什么Context的时候，可以使用这个，但是实际应用中，暂时还没有使用过这个TODO。 他们两个本质上都是emptyCtx结构体类型，是一个不可取消，没有设置截止时间，没有携带任何值的Context。  type emptyCtx int func (*emptyCtx) Deadline() (deadline time.Time, ok bool) { return } func (*emptyCtx) Done() \u0026lt;-chan struct{} { return nil } func (*emptyCtx) Err() error { return nil } func (*emptyCtx) Value(key interface{}) interface{} { return nil } Context的继承 有了如上的根Context，那么是如何衍生更多的子Context的呢？这就要靠context包为我们提供的With系列的函数了。\nfunc WithCancel(parent Context) (ctx Context, cancel CancelFunc) func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc) func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) func WithValue(parent Context, key, val interface{}) Context 通过这些函数，就创建了一颗Context树，树的每个节点都可以有任意多个子节点，节点层级可以有任意多个。\n WithCancel函数，传递一个父Context作为参数，返回子Context，以及一个取消函数用来取消Context。 WithDeadline函数，和WithCancel差不多，它会多传递一个截止时间参数，意味着到了这个时间点，会自动取消Context，当然我们也可以不等到这个时候，可以提前通过取消函数进行取消。 WithTimeout和WithDeadline基本上一样，这个表示是超时自动取消，是多少时间后自动取消Context的意思。 WithValue函数和取消Context无关，它是为了生成一个绑定了一个键值对数据的Context，这个绑定的数据可以通过Context.Value方法访问到，这是我们实际用经常要用到的技巧，一般我们想要通过上下文来传递数据时，可以通过这个方法，如我们需要tarce追踪系统调用栈的时候。  Context使用技巧和原则  不要把Context放在结构体中，要以参数的方式传递，parent Context一般为Background 应该要把Context作为第一个参数传递给入口请求和出口请求链路上的每一个函数，放在第一位，变量名建议都统一，如ctx。 给一个函数方法传递Context的时候，不要传递nil，否则在tarce追踪的时候，就会断了连接 Context的Value相关方法应该传递必须的数据，不要什么数据都使用这个传递 Context是线程安全的，可以放心的在多个goroutine中传递 可以把一个 Context 对象传递给任意个数的 gorotuine，对它执行 取消 操作时，所有 goroutine 都会接收到取消信号。  Context使用示例 请求链路传值 func func1(ctx context.Context) { ctx = context.WithValue(ctx, \u0026quot;k1\u0026quot;, \u0026quot;v1\u0026quot;) func2(ctx) } func func2(ctx context.Context) { fmt.Println(ctx.Value(\u0026quot;k1\u0026quot;).(string)) } func main() { ctx := context.Background() func1(ctx) } 我们在func1通过WithValue(parent Context, key, val interface{}) Context，赋值k1为v1， 在其下层函数func2通过ctx.Value(key interface{}) interface{}获取k1的值，比较简单。这里有个疑问，如果我是在func2里赋值， 在func1里面能够拿到这个值吗？答案是不能，context只能自上而下携带值，这个是要注意的一点。\n取消耗时操作，及时释放资源 主动取消 func func1(ctx context.Context, wg *sync.WaitGroup) error { defer wg.Done() respC := make(chan int) // 处理逻辑 go func() { time.Sleep(time.Second * 5) respC \u0026lt;- 10 }() // 取消机制 select { case \u0026lt;-ctx.Done(): fmt.Println(\u0026quot;cancel.\u0026quot;) return errors.New(\u0026quot;cancel\u0026quot;) case r := \u0026lt;-respC: fmt.Println(r) return nil } } func main() { wg := new(sync.WaitGroup) ctx, cancel := context.WithCancel(context.Background()) wg.Add(1) go func1(ctx, wg) time.Sleep(time.Second * 2) cancel() wg.Wait() } 超时取消 func func1(ctx context.Context) { hctx, hcancel := context.WithTimeout(ctx, time.Second*4) defer hcancel() resp := make(chan struct{}, 1) go func() { // 处理耗时操作 time.Sleep(time.Second * 10) resp \u0026lt;- struct{}{} }() select { // case \u0026lt;-ctx.Done(): // fmt.Println(\u0026quot;ctx timeout\u0026quot;) // fmt.Println(\u0026quot;退出\u0026quot;,ctx.Err()) case \u0026lt;-hctx.Done(): fmt.Println(\u0026quot;hctx timeout\u0026quot;) fmt.Println(hctx.Err()) case v := \u0026lt;-resp: fmt.Println(\u0026quot;test2 function handle done\u0026quot;) fmt.Printf(\u0026quot;result:%v\\n\u0026quot;, v) } fmt.Println(\u0026quot;test2 finish\u0026quot;) fmt.Println(time.Now().Unix()) return } func main() { fmt.Println(time.Now().Unix()) ctx, cancel := context.WithTimeout(context.Background(), time.Second*2) defer cancel() func1(ctx) } "
},
{
	"uri": "http://echotrue.github.io/game/nano/one-nano-request/",
	"title": "One Nano Request",
	"tags": [],
	"description": "",
	"content": "Websocket request 一般由网关节点向外部暴露n.ClientAddr地址并监听，接收客户端发送的请求。以websocket请求为例。listenAndServeWS方法负责监听n.ClientAddr并接收ws请求。接收到请求后交给节点下的LocalHandler的handleWs()方法，handleWs()会对连接对象封装成wsConn类型，结构如下：\ntype wsConn struct { conn *websocket.Conn typ int // message type \treader io.Reader } 然后开辟一个新的goroutine（LocalHandler.handle()方法）从连接中持续读取数据。\nLocalHandler.handle() 实例化一个Agent对象，相当于User Agent。它对应一个用户代理，用来存储原始连接信息。\nagent struct { // regular agent member \tsession *session.Session // session会话 \tconn net.Conn // low-level conn fd \tlastMid uint64 // last message id \tstate int32 // current agent state \tchDie chan struct{} // wait for close \tchSend chan pendingMessage // push message queue \tlastAt int64 // last heartbeat unix time stamp \tdecoder *codec.Decoder // binary decoder \tpipeline pipeline.Pipeline rpcHandler rpcHandler srv reflect.Value // cached session reflect.Value } 保存当前会话到当前节点。然后开辟一个goroutine监听channel消息。监听的消息类型如下：\n \u0026lt;-ticker.C类型。每隔30秒检测上一次心跳包的时间距离现在是否超过60秒，如果没超过则发送心跳包响应数据hbd到chWrite通道。反之，则return跳出当前for...select.进而执行defer延迟函数：  defer func() { ticker.Stop() //停止心跳包检测定时器 \tclose(a.chSend) //关闭推送消息队列 \tclose(chWrite) a.Close() //关闭当前User Agent \tif env.Debug { log.Println(fmt.Sprintf(\u0026#34;Session write goroutine exit, SessionID=%d, UID=%d\u0026#34;, a.session.ID(), a.session.UID())) } }()  \u0026lt;-chWrite类型。主要接收心跳包响应数据，并响应数据到客户端。 \u0026lt;-a.chSend类型。处理推送数据 \u0026lt;-a.chDie类型。 \u0026lt;-env.Die类型。应用退出通知  接着，循环从当前连接中读取网络数据包，并由LocalHandler.processPacket()方法根据网络数据包的类型处理消息。网络数据包有以下类型：\n Handshake = 0x01 表示握手：请求（客户端）\u0026lt;===\u0026gt;握手响应（服务端） HandshakeAck = 0x02 表示从客户端到服务端的握手确认 Heartbeat = 0x03 心跳数据包 Data = 0x04 通用数据包 Kick = 0x05 disconnect message from server  其中通用数据包是message.Message类型的。message的类型包含：Request/Notify/Response/Push。分别代表请求/通知/响应/推送。\nHandshake和HandshakeAck类型分别为设置当前UserAgent的状态为statusHandshake和statusWorking.Data类型数据会解码数据包中的Data字段并交给processMessage()处理。然后更新agent.lastAt为当前时间。\n循环读取消息失败时，会执行defer延迟函数。依次通知其他节点当前连接关闭。然后关闭当前连接。\nLocalHandler.processMessage() 判断message.Route是否是本地服务列表中。如果是本地服务进入localProcess() 反之进入remoteProcess()。\n先看localProcess()\n"
},
{
	"uri": "http://echotrue.github.io/algorithm/",
	"title": "Algorithm",
	"tags": [],
	"description": "",
	"content": "Chapter 2 Algorithm list \rGolang Search Slice\r\r\r"
},
{
	"uri": "http://echotrue.github.io/black-hat-go/",
	"title": "Black Hat Go",
	"tags": [],
	"description": "",
	"content": "Chapter 3 Black Hat Go \rTcp\r\r\r"
},
{
	"uri": "http://echotrue.github.io/game/nano/nano/",
	"title": "Nano",
	"tags": [],
	"description": "",
	"content": "Scheduler todo 启动节点后，开启一个goroutine执行go scheduler.Sched().\nPipeline todo "
},
{
	"uri": "http://echotrue.github.io/golang/array-slice/",
	"title": "Array And Slice",
	"tags": ["Go", "array", "slice", "数组", "切片"],
	"description": "",
	"content": "数组 数组类型定义了长度和元素类型。数组的长度是固定的，长度是数组类型的一部分。数组不需要显式的初始化；数组的零值是可以直接使用的，数组元素会自动初始化为其对应类型的零值。\nvar arr [4]int // 声明 fmt.Println(arr[1]) // 不需要显式的初始化 arr1 := [2]string{\u0026quot;Penn\u0026quot;, \u0026quot;Teller\u0026quot;} // 数组的字面值 arr2 := [...]string{\u0026quot;Penn\u0026quot;, \u0026quot;Teller\u0026quot;} // 编译器统计数组字面值中的元素数量 fmt.Println(arr1, len(arr1), cap(arr1)) fmt.Println(arr2, len(arr2), cap(arr2)) Go的数组是值语义。当一个数组变量被赋值或者被传递的时候，实际上会复制整个数组。 （为了避免复制数组，你可以传递一个指向数组的指针，但是数组指针并不是数组。）\nfunc update(arr *[2]string) { arr[1] = \u0026quot;axlrose\u0026quot; } func main() { arr1 := [2]string{\u0026quot;Penn\u0026quot;, \u0026quot;Teller\u0026quot;} update(\u0026amp;arr1) fmt.Println(arr1) } 切片的创建和初始化 Golang中切片有三种初始化方式：\n 通过下标的方式获得数组或者切片的一部分； 使用字面量初始化新的切片； 使用关键字 make 创建切片：  arr[0:3] or slice[0:3] slice := []int{1, 2, 3, 4} // 通过字面量创建并初始化长度，容量都为4的切片 slice := []int{99: 0} // 通过字面量创建并初始化长度和容量都是100的切片  slice := make([]int, 3, 4) // make() 创建并初始化长度为3，容量为4的切片  var slice []int // 只创建切片，不初始化。值为nil，又称空切片，它的长度和容量都为0  需要注意的是使用下标初始化切片不会造成原始数组或者切片中数据的拷贝，它只会创建一个指向原始数组的切片值，所以修改新切片的数据也会修改原始切片。\n 零值切片，nil切片和空切片  零切片：切片元素的值均是元素类型所对应的的0值切片  slice1 := make([]int, 10) fmt.Println(slice1) //[0 0 0 0 0 0 0 0 0 0] slice2 := make([]*int,10) fmt.Println(slice2) //[\u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt;] 切片追加和扩容 在分配内存空间之前需要先确定新的切片容量，Go 语言根据切片的当前容量选择不同的策略进行扩容：\n 如果期望容量大于当前容量的两倍就会使用期望容量； 如果当前切片的长度小于 1024 就会将容量翻倍； 如果当前切片的长度大于 1024 就会每次增加 25% 的容量，直到新容量大于期望容量；  "
},
{
	"uri": "http://echotrue.github.io/game/",
	"title": "Game",
	"tags": [],
	"description": "",
	"content": "Chapter 4 Game Server \rNano Server\r\r\rCombat System\r\r\rGame Vocabulary List\r\r\rTurn-Based Game With Go【译】\r\r\r"
},
{
	"uri": "http://echotrue.github.io/game/nano/nano-binary-protocol/",
	"title": "Nano Binary Protocol",
	"tags": [],
	"description": "",
	"content": "message.Encode func Encode(m *Message) ([]byte, error) { if invalidType(m.Type) { return nil, ErrWrongMessageType } buf := make([]byte, 0) // m.Type 最小时0x00 最大是0x03,左移一位，flag为0,2,4,6 \tflag := byte(m.Type) \u0026lt;\u0026lt; 1 // 如果路由压缩 flag|1 为1,3,5,7 \tcode, compressed := routes[m.Route] if compressed { flag |= msgRouteCompressMask } buf = append(buf, flag) if m.Type == Request || m.Type == Response { n := m.ID // variant length encode \tfor { //b是n/128余数，然后n按位右移7,相当于n、128。 \t//如果n为0，将b添加到buf， \t//如果n不为0，b+128 添加到buf，并继续执行相同的逻辑 \tb := byte(n % 128) n \u0026gt;\u0026gt;= 7 if n != 0 { buf = append(buf, b+128) } else { buf = append(buf, b) break } } } // 如果有route \t// 如果路由压缩：code 按位右移8，然后与0xff做位与操作，最后code只保留低八位，高八位补零。0xff为11111111 \tif routable(m.Type) { if compressed { buf = append(buf, byte((code\u0026gt;\u0026gt;8)\u0026amp;0xFF)) buf = append(buf, byte(code\u0026amp;0xFF)) } else { buf = append(buf, byte(len(m.Route))) buf = append(buf, []byte(m.Route)...) } } buf = append(buf, m.Data...) return buf, nil } message.Decode // Decode unmarshal the bytes slice to a message// See ref: https://github.com/lonnng/nano/blob/master/docs/communication_protocol.md func Decode(data []byte) (*Message, error) { if len(data) \u0026lt; msgHeadLength { return nil, ErrInvalidMessage } m := New() flag := data[0] offset := 1 // 获取type值 \tm.Type = Type((flag \u0026gt;\u0026gt; 1) \u0026amp; msgTypeMask) if invalidType(m.Type) { return nil, ErrWrongMessageType } if m.Type == Request || m.Type == Response { id := uint64(0) // little end byte order \t// WARNING: must can be stored in 64 bits integer \t// variant length encode \tfor i := offset; i \u0026lt; len(data); i++ { b := data[i] id += uint64(b\u0026amp;0x7F) \u0026lt;\u0026lt; uint64(7*(i-offset)) if b \u0026lt; 128 { offset = i + 1 break } } m.ID = id } if offset \u0026gt;= len(data) { return nil, ErrWrongMessage } if routable(m.Type) { if flag\u0026amp;msgRouteCompressMask == 1 { m.compressed = true code := binary.BigEndian.Uint16(data[offset:(offset + 2)]) route, ok := codes[code] if !ok { return nil, ErrRouteInfoNotFound } m.Route = route offset += 2 } else { m.compressed = false rl := data[offset] offset++ if offset+int(rl) \u0026gt;= len(data) { return nil, ErrWrongMessage } m.Route = string(data[offset:(offset + int(rl))]) offset += int(rl) } } if offset \u0026gt;= len(data) { return nil, ErrWrongMessage } m.Data = data[offset:] return m, nil } "
},
{
	"uri": "http://echotrue.github.io/sql/",
	"title": "Sql",
	"tags": [],
	"description": "",
	"content": "Chapter 5 Some Chapter title Lorem Ipsum.\n"
},
{
	"uri": "http://echotrue.github.io/book/",
	"title": "Book",
	"tags": [],
	"description": "",
	"content": "\r\r\rBook List\r\r\rGolang101-v1.14.e.pdf-ForPrinting.pdf\r\r(2811 ko)\r\r\rProgramming in Lua 4th Edition.pdf\r\r(1203 ko)\r\r\rReading 16GB File in Seconds, Golang.pdf\r\r(53 ko)\r\r\rTurn-Based Game With Go.pdf\r\r(3275 ko)\r\r\rgo-data-structures.pdf\r\r(2102 ko)\r\r\rgo-files-cheat-sheet.pdf\r\r(52 ko)\r\r\rgolang-naming-conventions-cheat-sheet.pdf\r\r(78 ko)\r\r\rturn-based-game-with-go.pdf\r\r(8010 ko)\r\r\r\r"
},
{
	"uri": "http://echotrue.github.io/cont/pages/",
	"title": "Pages organization",
	"tags": [],
	"description": "",
	"content": "In Hugo, pages are the core of your site. Once it is configured, pages are definitely the added value to your documentation site.\nFolders Organize your site like any other Hugo project. Typically, you will have a content folder with all your pages.\ncontent\r├── level-one\r│ ├── level-two\r│ │ ├── level-three\r│ │ │ ├── level-four\r│ │ │ │ ├── _index.md \u0026lt;-- /level-one/level-two/level-three/level-four\r│ │ │ │ ├── page-4-a.md \u0026lt;-- /level-one/level-two/level-three/level-four/page-4-a\r│ │ │ │ ├── page-4-b.md \u0026lt;-- /level-one/level-two/level-three/level-four/page-4-b\r│ │ │ │ └── page-4-c.md \u0026lt;-- /level-one/level-two/level-three/level-four/page-4-c\r│ │ │ ├── _index.md \u0026lt;-- /level-one/level-two/level-three\r│ │ │ ├── page-3-a.md \u0026lt;-- /level-one/level-two/level-three/page-3-a\r│ │ │ ├── page-3-b.md \u0026lt;-- /level-one/level-two/level-three/page-3-b\r│ │ │ └── page-3-c.md \u0026lt;-- /level-one/level-two/level-three/page-3-c\r│ │ ├── _index.md \u0026lt;-- /level-one/level-two\r│ │ ├── page-2-a.md \u0026lt;-- /level-one/level-two/page-2-a\r│ │ ├── page-2-b.md \u0026lt;-- /level-one/level-two/page-2-b\r│ │ └── page-2-c.md \u0026lt;-- /level-one/level-two/page-2-c\r│ ├── _index.md \u0026lt;-- /level-one\r│ ├── page-1-a.md \u0026lt;-- /level-one/page-1-a\r│ ├── page-1-b.md \u0026lt;-- /level-one/page-1-b\r│ └── page-1-c.md \u0026lt;-- /level-one/page-1-c\r├── _index.md \u0026lt;-- /\r└── page-top.md \u0026lt;-- /page-top\r _index.md is required in each folder, it’s your “folder home page”\n\rTypes Hugo-theme-learn defines two types of pages. Default and Chapter. Both can be used at any level of the documentation, the only difference being layout display.\nA Chapter displays a page meant to be used as introduction for a set of child pages. Commonly, it contains a simple title and a catch line to define content that can be found under it. You can define any HTML as prefix for the menu. In the example below, it\u0026rsquo;s just a number but that could be an icon.\n+++ title = \u0026#34;Basics\u0026#34; chapter = true weight = 5 pre = \u0026#34;\u0026lt;b\u0026gt;1. \u0026lt;/b\u0026gt;\u0026#34; +++ ### Chapter 1  # Basics Discover what this Hugo theme is all about and the core-concepts behind it. To tell Hugo-theme-learn to consider a page as a chapter, set chapter=true in the Front Matter of the page.\nA Default page is any other content page.\n+++ title = \u0026#34;Installation\u0026#34; weight = 15 +++ The following steps are here to help you initialize your new website. If you don\u0026rsquo;t know Hugo at all, we strongly suggest you to train by following this great documentation for beginners.\nCreate your project Hugo provides a new command to create a new website.\nhugo new site \u0026lt;new_project\u0026gt;\rHugo-theme-learn provides archetypes to help you create this kind of pages.\nFront Matter configuration Each Hugo page has to define a Front Matter in yaml, toml or json.\nHugo-theme-learn uses the following parameters on top of Hugo ones :\n+++ # Table of content (toc) is enabled by default. Set this parameter to true to disable it. # Note: Toc is always disabled for chapter pages disableToc = \u0026#34;false\u0026#34; # If set, this will be used for the page\u0026#39;s menu entry (instead of the `title` attribute) menuTitle = \u0026#34;\u0026#34; # The title of the page in menu will be prefixed by this HTML content pre = \u0026#34;\u0026#34; # The title of the page in menu will be postfixed by this HTML content post = \u0026#34;\u0026#34; # Set the page as a chapter, changing the way it\u0026#39;s displayed chapter = false # Hide a menu entry by setting this to true hidden = false # Display name of this page modifier. If set, it will be displayed in the footer. LastModifierDisplayName = \u0026#34;\u0026#34; # Email of this page modifier. If set with LastModifierDisplayName, it will be displayed in the footer LastModifierEmail = \u0026#34;\u0026#34; +++ Add icon to a menu entry In the page frontmatter, add a pre param to insert any HTML code before the menu label. The example below uses the Github icon.\n+++ title = \u0026#34;Github repo\u0026#34; pre = \u0026#34;\u0026lt;i class=\u0026#39;fab fa-github\u0026#39;\u0026gt;\u0026lt;/i\u0026gt; \u0026#34; +++ Ordering sibling menu/page entries Hugo provides a flexible way to handle order for your pages.\nThe simplest way is to set weight parameter to a number.\n+++ title = \u0026#34;My page\u0026#34; weight = 5 +++ Using a custom title for menu entries By default, Hugo-theme-learn will use a page\u0026rsquo;s title attribute for the menu item (or linkTitle if defined).\nBut a page\u0026rsquo;s title has to be descriptive on its own while the menu is a hierarchy. We\u0026rsquo;ve added the menuTitle parameter for that purpose:\nFor example (for a page named content/install/linux.md):\n+++ title = \u0026#34;Install on Linux\u0026#34; menuTitle = \u0026#34;Linux\u0026#34; +++ Homepage To configure your home page, you basically have three choices:\n Create an _index.md document in content folder and fill the file with Markdown content Create an index.html file in the static folder and fill the file with HTML content Configure your server to automatically redirect home page to one your documentation page  "
},
{
	"uri": "http://echotrue.github.io/cont/archetypes/",
	"title": "Archetypes",
	"tags": [],
	"description": "",
	"content": "Using the command: hugo new [relative new content path], you can start a content file with the date and title automatically set. While this is a welcome feature, active writers need more : archetypes.\nIt is pre-configured skeleton pages with default front matter. Please refer to the documentation for types of page to understand the differences.\nChapter To create a Chapter page, run the following commands\nhugo new --kind chapter \u0026lt;name\u0026gt;/_index.md\rIt will create a page with predefined Front-Matter:\n+++ title = \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; date = {{ .Date }} weight = 5 chapter = true pre = \u0026#34;\u0026lt;b\u0026gt;X. \u0026lt;/b\u0026gt;\u0026#34; +++ ### Chapter X  # Some Chapter title Lorem Ipsum. Default To create a default page, run either one of the following commands\n# Either\rhugo new \u0026lt;chapter\u0026gt;/\u0026lt;name\u0026gt;/_index.md\r# Or\rhugo new \u0026lt;chapter\u0026gt;/\u0026lt;name\u0026gt;.md\rIt will create a page with predefined Front-Matter:\n+++ title = \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; date = {{ .Date }} weight = 5 +++ Lorem Ipsum. "
},
{
	"uri": "http://echotrue.github.io/basics/requirements/",
	"title": "Requirements",
	"tags": [],
	"description": "",
	"content": "Thanks to the simplicity of Hugo, this page is as empty as this theme needs requirements.\nJust download latest version of Hugo binary (\u0026gt; 0.25) for your OS (Windows, Linux, Mac) : it\u0026rsquo;s that simple.\n"
},
{
	"uri": "http://echotrue.github.io/cont/markdown/",
	"title": "Markdown syntax",
	"tags": [],
	"description": "",
	"content": "\rThis page is a shameful copy of the great Grav original page. Only difference is information about image customization (resizing, add CSS classes\u0026hellip;)\n\rLet\u0026rsquo;s face it: Writing content for the Web is tiresome. WYSIWYG editors help alleviate this task, but they generally result in horrible code, or worse yet, ugly web pages.\nMarkdown is a better way to write HTML, without all the complexities and ugliness that usually accompanies it.\nSome of the key benefits are:\n Markdown is simple to learn, with minimal extra characters so it\u0026rsquo;s also quicker to write content. Less chance of errors when writing in markdown. Produces valid XHTML output. Keeps the content and the visual display separate, so you cannot mess up the look of your site. Write in any text editor or Markdown application you like. Markdown is a joy to use!  John Gruber, the author of Markdown, puts it like this:\n The overriding design goal for Markdown’s formatting syntax is to make it as readable as possible. The idea is that a Markdown-formatted document should be publishable as-is, as plain text, without looking like it’s been marked up with tags or formatting instructions. While Markdown’s syntax has been influenced by several existing text-to-HTML filters, the single biggest source of inspiration for Markdown’s syntax is the format of plain text email. \u0026ndash; John Gruber\n Grav ships with built-in support for Markdown and Markdown Extra. You must enable Markdown Extra in your system.yaml configuration file\nWithout further delay, let us go over the main elements of Markdown and what the resulting HTML looks like:\nBookmark this page for easy future reference!\n\rHeadings Headings from h1 through h6 are constructed with a # for each level:\n# h1 Heading ## h2 Heading ### h3 Heading #### h4 Heading ##### h5 Heading ###### h6 Heading Renders to:\nh1 Heading h2 Heading h3 Heading h4 Heading h5 Heading h6 Heading HTML:\n\u0026lt;h1\u0026gt;h1 Heading\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;h2 Heading\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;h3 Heading\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;h4 Heading\u0026lt;/h4\u0026gt; \u0026lt;h5\u0026gt;h5 Heading\u0026lt;/h5\u0026gt; \u0026lt;h6\u0026gt;h6 Heading\u0026lt;/h6\u0026gt; Comments Comments should be HTML compatible\n\u0026lt;!-- This is a comment --\u0026gt; Comment below should NOT be seen:\nHorizontal Rules The HTML \u0026lt;hr\u0026gt; element is for creating a \u0026ldquo;thematic break\u0026rdquo; between paragraph-level elements. In markdown, you can create a \u0026lt;hr\u0026gt; with any of the following:\n ___: three consecutive underscores ---: three consecutive dashes ***: three consecutive asterisks  renders to:\n Body Copy Body copy written as normal, plain text will be wrapped with \u0026lt;p\u0026gt;\u0026lt;/p\u0026gt; tags in the rendered HTML.\nSo this body copy:\nLorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad. renders to this HTML:\n\u0026lt;p\u0026gt;Lorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad.\u0026lt;/p\u0026gt; Emphasis Bold For emphasizing a snippet of text with a heavier font-weight.\nThe following snippet of text is rendered as bold text.\n**rendered as bold text** renders to:\nrendered as bold text\nand this HTML\n\u0026lt;strong\u0026gt;rendered as bold text\u0026lt;/strong\u0026gt; Italics For emphasizing a snippet of text with italics.\nThe following snippet of text is rendered as italicized text.\n_rendered as italicized text_ renders to:\nrendered as italicized text\nand this HTML:\n\u0026lt;em\u0026gt;rendered as italicized text\u0026lt;/em\u0026gt; Strikethrough In GFM (GitHub flavored Markdown) you can do strikethroughs.\n~~Strike through this text.~~ Which renders to:\nStrike through this text.\nHTML:\n\u0026lt;del\u0026gt;Strike through this text.\u0026lt;/del\u0026gt; Blockquotes For quoting blocks of content from another source within your document.\nAdd \u0026gt; before any text you want to quote.\n\u0026gt; **Fusion Drive** combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. Renders to:\n Fusion Drive combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined.\n and this HTML:\n\u0026lt;blockquote\u0026gt; \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Fusion Drive\u0026lt;/strong\u0026gt; combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined.\u0026lt;/p\u0026gt; \u0026lt;/blockquote\u0026gt; Blockquotes can also be nested:\n\u0026gt; Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi. \u0026gt; \u0026gt; \u0026gt; Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam. \u0026gt; \u0026gt; Mauris sit amet ligula egestas, feugiat metus tincidunt, luctus libero. Donec congue finibus tempor. Vestibulum aliquet sollicitudin erat, ut aliquet purus posuere luctus. Renders to:\n Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi.\n Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam.\n Mauris sit amet ligula egestas, feugiat metus tincidunt, luctus libero. Donec congue finibus tempor. Vestibulum aliquet sollicitudin erat, ut aliquet purus posuere luctus.\n Notices The old mechanism for notices overriding the block quote syntax (\u0026gt;\u0026gt;\u0026gt;) has been deprecated. Notices are now handled via a dedicated plugin called Markdown Notices\n\rLists Unordered A list of items in which the order of the items does not explicitly matter.\nYou may use any of the following symbols to denote bullets for each list item:\n* valid bullet - valid bullet + valid bullet For example\n+ Lorem ipsum dolor sit amet + Consectetur adipiscing elit + Integer molestie lorem at massa + Facilisis in pretium nisl aliquet + Nulla volutpat aliquam velit - Phasellus iaculis neque - Purus sodales ultricies - Vestibulum laoreet porttitor sem - Ac tristique libero volutpat at + Faucibus porta lacus fringilla vel + Aenean sit amet erat nunc + Eget porttitor lorem Renders to:\n Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit  Phasellus iaculis neque Purus sodales ultricies Vestibulum laoreet porttitor sem Ac tristique libero volutpat at   Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem  And this HTML\n\u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;Lorem ipsum dolor sit amet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Consectetur adipiscing elit\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Integer molestie lorem at massa\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Facilisis in pretium nisl aliquet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Nulla volutpat aliquam velit \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;Phasellus iaculis neque\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Purus sodales ultricies\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Vestibulum laoreet porttitor sem\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Ac tristique libero volutpat at\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Faucibus porta lacus fringilla vel\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Aenean sit amet erat nunc\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Eget porttitor lorem\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; Ordered A list of items in which the order of items does explicitly matter.\n1. Lorem ipsum dolor sit amet 4. Consectetur adipiscing elit 2. Integer molestie lorem at massa 8. Facilisis in pretium nisl aliquet 4. Nulla volutpat aliquam velit 99. Faucibus porta lacus fringilla vel 21. Aenean sit amet erat nunc 6. Eget porttitor lorem Renders to:\n Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem  And this HTML:\n\u0026lt;ol\u0026gt; \u0026lt;li\u0026gt;Lorem ipsum dolor sit amet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Consectetur adipiscing elit\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Integer molestie lorem at massa\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Facilisis in pretium nisl aliquet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Nulla volutpat aliquam velit\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Faucibus porta lacus fringilla vel\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Aenean sit amet erat nunc\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Eget porttitor lorem\u0026lt;/li\u0026gt; \u0026lt;/ol\u0026gt; TIP: If you just use 1. for each number, Markdown will automatically number each item. For example:\n1. Lorem ipsum dolor sit amet 1. Consectetur adipiscing elit 1. Integer molestie lorem at massa 1. Facilisis in pretium nisl aliquet 1. Nulla volutpat aliquam velit 1. Faucibus porta lacus fringilla vel 1. Aenean sit amet erat nunc 1. Eget porttitor lorem Renders to:\n Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem  Code Inline code Wrap inline snippets of code with `.\nIn this example, `\u0026lt;section\u0026gt;\u0026lt;/section\u0026gt;` should be wrapped as **code**. Renders to:\nIn this example, \u0026lt;section\u0026gt;\u0026lt;/section\u0026gt; should be wrapped as code.\nHTML:\n\u0026lt;p\u0026gt;In this example, \u0026lt;code\u0026gt;\u0026amp;lt;section\u0026amp;gt;\u0026amp;lt;/section\u0026amp;gt;\u0026lt;/code\u0026gt; should be wrapped as \u0026lt;strong\u0026gt;code\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt; Indented code Or indent several lines of code by at least two spaces, as in:\n// Some comments line 1 of code line 2 of code line 3 of code Renders to:\n// Some comments\rline 1 of code\rline 2 of code\rline 3 of code\r HTML:\n\u0026lt;pre\u0026gt; \u0026lt;code\u0026gt; // Some comments line 1 of code line 2 of code line 3 of code \u0026lt;/code\u0026gt; \u0026lt;/pre\u0026gt; Block code \u0026ldquo;fences\u0026rdquo; Use \u0026ldquo;fences\u0026rdquo; ``` to block in multiple lines of code.\nSample text here... HTML:\n\u0026lt;pre\u0026gt; \u0026lt;code\u0026gt;Sample text here...\u0026lt;/code\u0026gt; \u0026lt;/pre\u0026gt; Syntax highlighting GFM, or \u0026ldquo;GitHub Flavored Markdown\u0026rdquo; also supports syntax highlighting. To activate it, simply add the file extension of the language you want to use directly after the first code \u0026ldquo;fence\u0026rdquo;, ```js, and syntax highlighting will automatically be applied in the rendered HTML.\nSee Code Highlighting for additional documentation.\nFor example, to apply syntax highlighting to JavaScript code:\n```js grunt.initConfig({ assemble: { options: { assets: \u0026#39;docs/assets\u0026#39;, data: \u0026#39;src/data/*.{json,yml}\u0026#39;, helpers: \u0026#39;src/custom-helpers.js\u0026#39;, partials: [\u0026#39;src/partials/**/*.{hbs,md}\u0026#39;] }, pages: { options: { layout: \u0026#39;default.hbs\u0026#39; }, files: { \u0026#39;./\u0026#39;: [\u0026#39;src/templates/pages/index.hbs\u0026#39;] } } } }; ``` Renders to:\ngrunt.initConfig({ assemble: { options: { assets: \u0026#39;docs/assets\u0026#39;, data: \u0026#39;src/data/*.{json,yml}\u0026#39;, helpers: \u0026#39;src/custom-helpers.js\u0026#39;, partials: [\u0026#39;src/partials/**/*.{hbs,md}\u0026#39;] }, pages: { options: { layout: \u0026#39;default.hbs\u0026#39; }, files: { \u0026#39;./\u0026#39;: [\u0026#39;src/templates/pages/index.hbs\u0026#39;] } } } }; Tables Tables are created by adding pipes as dividers between each cell, and by adding a line of dashes (also separated by bars) beneath the header. Note that the pipes do not need to be vertically aligned.\n| Option | Description | | ------ | ----------- | | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. | Renders to:\n   Option Description     data path to data files to supply the data that will be passed into templates.   engine engine to be used for processing templates. Handlebars is the default.   ext extension to be used for dest files.    And this HTML:\n\u0026lt;table\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;Option\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;Description\u0026lt;/th\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;data\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;path to data files to supply the data that will be passed into templates.\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;engine\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;engine to be used for processing templates. Handlebars is the default.\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;ext\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;extension to be used for dest files.\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; Right aligned text Adding a colon on the right side of the dashes below any heading will right align text for that column.\n| Option | Description | | ------:| -----------:| | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. |    Option Description     data path to data files to supply the data that will be passed into templates.   engine engine to be used for processing templates. Handlebars is the default.   ext extension to be used for dest files.    Links Basic link [Assemble](http://assemble.io) Renders to (hover over the link, there is no tooltip):\nAssemble\nHTML:\n\u0026lt;a href=\u0026#34;http://assemble.io\u0026#34;\u0026gt;Assemble\u0026lt;/a\u0026gt; Add a tooltip [Upstage](https://github.com/upstage/ \u0026#34;Visit Upstage!\u0026#34;) Renders to (hover over the link, there should be a tooltip):\nUpstage\nHTML:\n\u0026lt;a href=\u0026#34;https://github.com/upstage/\u0026#34; title=\u0026#34;Visit Upstage!\u0026#34;\u0026gt;Upstage\u0026lt;/a\u0026gt; Named Anchors Named anchors enable you to jump to the specified anchor point on the same page. For example, each of these chapters:\n# Table of Contents * [Chapter 1](#chapter-1) * [Chapter 2](#chapter-2) * [Chapter 3](#chapter-3) will jump to these sections:\n## Chapter 1 \u0026lt;a id=\u0026#34;chapter-1\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; Content for chapter one. ## Chapter 2 \u0026lt;a id=\u0026#34;chapter-2\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; Content for chapter one. ## Chapter 3 \u0026lt;a id=\u0026#34;chapter-3\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; Content for chapter one. NOTE that specific placement of the anchor tag seems to be arbitrary. They are placed inline here since it seems to be unobtrusive, and it works.\nImages Images have a similar syntax to links but include a preceding exclamation point.\n![Minion](https://octodex.github.com/images/minion.png) or\n![Alt text](https://octodex.github.com/images/stormtroopocat.jpg \u0026#34;The Stormtroopocat\u0026#34;) Like links, Images also have a footnote style syntax\nAlternative usage : note images ![Alt text][id] With a reference later in the document defining the URL location:\n[id]: https://octodex.github.com/images/dojocat.jpg \u0026quot;The Dojocat\u0026quot;\r Resizing image Add HTTP parameters width and/or height to the link image to resize the image. Values are CSS values (default is auto).\n![Minion](https://octodex.github.com/images/minion.png?width=20pc) ![Minion](https://octodex.github.com/images/minion.png?height=50px) ![Minion](https://octodex.github.com/images/minion.png?height=50px\u0026amp;width=300px) Add CSS classes Add a HTTP classes parameter to the link image to add CSS classes. shadowand border are available but you could define other ones.\n![stormtroopocat](https://octodex.github.com/images/stormtroopocat.jpg?classes=shadow) ![stormtroopocat](https://octodex.github.com/images/stormtroopocat.jpg?classes=border) ![stormtroopocat](https://octodex.github.com/images/stormtroopocat.jpg?classes=border,shadow) Lightbox Add a HTTP featherlight parameter to the link image to disable lightbox. By default lightbox is enabled using the featherlight.js plugin. You can disable this by defining featherlight to false.\n![Minion](https://octodex.github.com/images/minion.png?featherlight=false) "
},
{
	"uri": "http://echotrue.github.io/basics/installation/",
	"title": "Installation",
	"tags": [],
	"description": "",
	"content": "The following steps are here to help you initialize your new website. If you don\u0026rsquo;t know Hugo at all, we strongly suggest you learn more about it by following this great documentation for beginners.\nCreate your project Hugo provides a new command to create a new website.\nhugo new site \u0026lt;new_project\u0026gt;\rInstall the theme Install the Hugo-theme-learn theme by following this documentation\nThis theme\u0026rsquo;s repository is: https://github.com/matcornic/hugo-theme-learn.git\nAlternatively, you can download the theme as .zip file and extract it in the themes directory\nBasic configuration When building the website, you can set a theme by using --theme option. However, we suggest you modify the configuration file (config.toml) and set the theme as the default. You can also add the [outputs] section to enable the search functionality.\n# Change the default theme to be use when building the site with Hugo theme = \u0026#34;hugo-theme-learn\u0026#34; # For search functionality [outputs] home = [ \u0026#34;HTML\u0026#34;, \u0026#34;RSS\u0026#34;, \u0026#34;JSON\u0026#34;] Create your first chapter page Chapters are pages that contain other child pages. It has a special layout style and usually just contains a chapter name, the title and a brief abstract of the section.\n### Chapter 1\r# Basics\rDiscover what this Hugo theme is all about and the core concepts behind it.\rrenders as\nHugo-theme-learn provides archetypes to create skeletons for your website. Begin by creating your first chapter page with the following command\nhugo new --kind chapter basics/_index.md\rBy opening the given file, you should see the property chapter=true on top, meaning this page is a chapter.\nBy default all chapters and pages are created as a draft. If you want to render these pages, remove the property draft: true from the metadata.\nCreate your first content pages Then, create content pages inside the previously created chapter. Here are two ways to create content in the chapter:\nhugo new basics/first-content.md\rhugo new basics/second-content/_index.md\rFeel free to edit thoses files by adding some sample content and replacing the title value in the beginning of the files.\nLaunching the website locally Launch by using the following command:\nhugo serve\rGo to http://localhost:1313\nYou should notice three things:\n You have a left-side Basics menu, containing two submenus with names equal to the title properties in the previously created files. The home page explains how to customize it by following the instructions. When you run hugo serve, when the contents of the files change, the page automatically refreshes with the changes. Neat!  Build the website When your site is ready to deploy, run the following command:\nhugo\rA public folder will be generated, containing all static content and assets for your website. It can now be deployed on any web server.\nThis website can be automatically published and hosted with Netlify (Read more about Automated HUGO deployments with Netlify). Alternatively, you can use Github pages\n\r"
},
{
	"uri": "http://echotrue.github.io/cont/syntaxhighlight/",
	"title": "Code highlighting",
	"tags": [],
	"description": "",
	"content": "Learn theme uses highlight.js to provide code syntax highlighting.\nMarkdown syntax Wrap the code block with three backticks and the name of the language. Highlight will try to auto detect the language if one is not provided.\n```json [ { \u0026#34;title\u0026#34;: \u0026#34;apples\u0026#34;, \u0026#34;count\u0026#34;: [12000, 20000], \u0026#34;description\u0026#34;: {\u0026#34;text\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;sensitive\u0026#34;: false} }, { \u0026#34;title\u0026#34;: \u0026#34;oranges\u0026#34;, \u0026#34;count\u0026#34;: [17500, null], \u0026#34;description\u0026#34;: {\u0026#34;text\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;sensitive\u0026#34;: false} } ] ``` Renders to:\n[ { \u0026#34;title\u0026#34;: \u0026#34;apples\u0026#34;, \u0026#34;count\u0026#34;: [12000, 20000], \u0026#34;description\u0026#34;: {\u0026#34;text\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;sensitive\u0026#34;: false} }, { \u0026#34;title\u0026#34;: \u0026#34;oranges\u0026#34;, \u0026#34;count\u0026#34;: [17500, null], \u0026#34;description\u0026#34;: {\u0026#34;text\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;sensitive\u0026#34;: false} } ] Supported languages Learn theme ships with its own version of highlight.js to support offline browsing. The included package supports 38 common languages, as described on the highlight.js download page.\nIdentifying failed language detection Highlight will write a warning to the browser console if a requested language was not found. For example, the following code block references an imaginary language foo. An error will be output to the console on this page.\n```foo bar ``` Could not find the language 'foo', did you forget to load/include a language module?(anonymous) @ highlight.pack.js\rSupporting additional languages To support languages other than the 38 common languages included in the default highlight.js you will need to download your own version of highlight.js and add it to your site content.\nDownload custom highlight.js Visit https://highlightjs.org/download/ and select your desired language support. Note that more languages means greater package size.\nAdd custom highlight.js to static resources Inside the zip archive downloaded from highlight.js extract the file named highlight.pack.js. Move this file to the new location\nstatic/js/highlight.pack.js\rDo not replace the existing file at themes/hugo-theme-learn/static/js/highlight.pack.js.\nIncluding the file in the correct path will override the theme default highlight.pack.js and prevent issues caused in the future if the theme default file is updated.\nFurther usage information See https://highlightjs.org/usage/\n"
},
{
	"uri": "http://echotrue.github.io/basics/configuration/",
	"title": "Configuration",
	"tags": [],
	"description": "",
	"content": "Global site parameters On top of Hugo global configuration, Hugo-theme-learn lets you define the following parameters in your config.toml (here, values are default).\nNote that some of these parameters are explained in details in other sections of this documentation.\n[params] # Prefix URL to edit current page. Will display an \u0026#34;Edit this page\u0026#34; button on top right hand corner of every page. # Useful to give opportunity to people to create merge request for your doc. # See the config.toml file from this documentation site to have an example. editURL = \u0026#34;\u0026#34; # Author of the site, will be used in meta information author = \u0026#34;\u0026#34; # Description of the site, will be used in meta information description = \u0026#34;\u0026#34; # Shows a checkmark for visited pages on the menu showVisitedLinks = false # Disable search function. It will hide search bar disableSearch = false # Javascript and CSS cache are automatically busted when new version of site is generated. # Set this to true to disable this behavior (some proxies don\u0026#39;t handle well this optimization) disableAssetsBusting = false # Set this to true to disable copy-to-clipboard button for inline code. disableInlineCopyToClipBoard = false # A title for shortcuts in menu is set by default. Set this to true to disable it. disableShortcutsTitle = false # When using mulitlingual website, disable the switch language button. disableLanguageSwitchingButton = false # Hide breadcrumbs in the header and only show the current page title disableBreadcrumb = true # Hide Next and Previous page buttons normally displayed full height beside content disableNextPrev = true # Order sections in menu by \u0026#34;weight\u0026#34; or \u0026#34;title\u0026#34;. Default to \u0026#34;weight\u0026#34; ordersectionsby = \u0026#34;weight\u0026#34; # Change default color scheme with a variant one. Can be \u0026#34;red\u0026#34;, \u0026#34;blue\u0026#34;, \u0026#34;green\u0026#34;. themeVariant = \u0026#34;\u0026#34; # Provide a list of custom css files to load relative from the `static/` folder in the site root. custom_css = [\u0026#34;css/foo.css\u0026#34;, \u0026#34;css/bar.css\u0026#34;] Activate search If not already present, add the follow lines in the same config.toml file.\n[outputs] home = [ \u0026#34;HTML\u0026#34;, \u0026#34;RSS\u0026#34;, \u0026#34;JSON\u0026#34;] Learn theme uses the last improvement available in hugo version 20+ to generate a json index file ready to be consumed by lunr.js javascript search engine.\n Hugo generate lunrjs index.json at the root of public folder. When you build the site with hugo server, hugo generates it internally and of course it doesn’t show up in the filesystem\n "
},
{
	"uri": "http://echotrue.github.io/cont/menushortcuts/",
	"title": "Menu extra shortcuts",
	"tags": [],
	"description": "",
	"content": "You can define additional menu entries or shortcuts in the navigation menu without any link to content.\nBasic configuration Edit the website configuration config.toml and add a [[menu.shortcuts]] entry for each link your want to add.\nExample from the current website:\n[[menu.shortcuts]] name = \u0026quot;\u0026lt;i class='fab fa-github'\u0026gt;\u0026lt;/i\u0026gt; Github repo\u0026quot;\ridentifier = \u0026quot;ds\u0026quot;\rurl = \u0026quot;https://github.com/matcornic/hugo-theme-learn\u0026quot;\rweight = 10\r[[menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-camera'\u0026gt;\u0026lt;/i\u0026gt; Showcases\u0026quot;\rurl = \u0026quot;/showcase\u0026quot;\rweight = 11\r[[menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-bookmark'\u0026gt;\u0026lt;/i\u0026gt; Hugo Documentation\u0026quot;\ridentifier = \u0026quot;hugodoc\u0026quot;\rurl = \u0026quot;https://gohugo.io/\u0026quot;\rweight = 20\r[[menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-bullhorn'\u0026gt;\u0026lt;/i\u0026gt; Credits\u0026quot;\rurl = \u0026quot;/credits\u0026quot;\rweight = 30\r By default, shortcuts are preceded by a title. This title can be disabled by setting disableShortcutsTitle=true. However, if you want to keep the title but change its value, it can be overriden by changing your local i18n translation string configuration.\nFor example, in your local i18n/en.toml file, add the following content\n[Shortcuts-Title]\rother = \u0026quot;\u0026lt;Your value\u0026gt;\u0026quot;\r Read more about hugo menu and hugo i18n translation strings\nConfiguration for Multilingual mode When using a multilingual website, you can set different menus for each language. In the config.toml file, prefix your menu configuration by Languages.\u0026lt;language-id\u0026gt;.\nExample from the current website:\n[Languages]\r[Languages.en]\rtitle = \u0026quot;Documentation for Hugo Learn Theme\u0026quot;\rweight = 1\rlanguageName = \u0026quot;English\u0026quot;\r[[Languages.en.menu.shortcuts]] name = \u0026quot;\u0026lt;i class='fab fa-github'\u0026gt;\u0026lt;/i\u0026gt; Github repo\u0026quot;\ridentifier = \u0026quot;ds\u0026quot;\rurl = \u0026quot;https://github.com/matcornic/hugo-theme-learn\u0026quot;\rweight = 10\r[[Languages.en.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-camera'\u0026gt;\u0026lt;/i\u0026gt; Showcases\u0026quot;\rurl = \u0026quot;/showcase\u0026quot;\rweight = 11\r[[Languages.en.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-bookmark'\u0026gt;\u0026lt;/i\u0026gt; Hugo Documentation\u0026quot;\ridentifier = \u0026quot;hugodoc\u0026quot;\rurl = \u0026quot;https://gohugo.io/\u0026quot;\rweight = 20\r[[Languages.en.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-bullhorn'\u0026gt;\u0026lt;/i\u0026gt; Credits\u0026quot;\rurl = \u0026quot;/credits\u0026quot;\rweight = 30\r[Languages.fr]\rtitle = \u0026quot;Documentation du thème Hugo Learn\u0026quot;\rweight = 2\rlanguageName = \u0026quot;Français\u0026quot;\r[[Languages.fr.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fab fa-github'\u0026gt;\u0026lt;/i\u0026gt; Repo Github\u0026quot;\ridentifier = \u0026quot;ds\u0026quot;\rurl = \u0026quot;https://github.com/matcornic/hugo-theme-learn\u0026quot;\rweight = 10\r[[Languages.fr.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-camera'\u0026gt;\u0026lt;/i\u0026gt; Vitrine\u0026quot;\rurl = \u0026quot;/showcase\u0026quot;\rweight = 11\r[[Languages.fr.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-bookmark'\u0026gt;\u0026lt;/i\u0026gt; Documentation Hugo\u0026quot;\ridentifier = \u0026quot;hugodoc\u0026quot;\rurl = \u0026quot;https://gohugo.io/\u0026quot;\rweight = 20\r[[Languages.fr.menu.shortcuts]]\rname = \u0026quot;\u0026lt;i class='fas fa-bullhorn'\u0026gt;\u0026lt;/i\u0026gt; Crédits\u0026quot;\rurl = \u0026quot;/credits\u0026quot;\rweight = 30\r Read more about hugo menu and hugo multilingual menus\n"
},
{
	"uri": "http://echotrue.github.io/basics/style-customization/",
	"title": "Style customization",
	"tags": [],
	"description": "",
	"content": "Hugo-theme-learn has been built to be as configurable as possible by defining multiple partials\nIn themes/hugo-theme-learn/layouts/partials/, you will find all the partials defined for this theme. If you need to overwrite something, don\u0026rsquo;t change the code directly. Instead follow this page. You\u0026rsquo;d create a new partial in the layouts/partials folder of your local project. This partial will have the priority.\nThis theme defines the following partials :\n header: the header of the content page (contains the breadcrumbs). Not meant to be overwritten custom-header: custom headers in page. Meant to be overwritten when adding CSS imports. Don\u0026rsquo;t forget to include style HTML tag directive in your file footer: the footer of the content page (contains the arrows). Not meant to be overwritten custom-footer: custom footer in page. Meant to be overwritten when adding Javacript. Don\u0026rsquo;t forget to include javascript HTML tag directive in your file favicon: the favicon logo: the logo, on top left hand corner. meta: HTML meta tags, if you want to change default behavior menu: left menu. Not meant to be overwritten menu-footer: footer of the the left menu search: search box toc: table of contents  Change the logo Create a new file in layouts/partials/ named logo.html. Then write any HTML you want. You could use an img HTML tag and reference an image created under the static folder, or you could paste a SVG definition !\nThe size of the logo will adapt automatically\n\rChange the favicon If your favicon is a png, just drop off your image in your local static/images/ folder and name it favicon.png\nIf you need to change this default behavior, create a new file in layouts/partials/ named favicon.html. Then write something like this:\n\u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;/images/favicon.png\u0026#34; type=\u0026#34;image/x-icon\u0026#34; /\u0026gt; Change default colors Hugo Learn theme let you choose between 3 native color scheme variants, but feel free to add one yourself ! Default color scheme is based on Grav Learn Theme.\nRed variant [params] # Change default color scheme with a variant one. Can be \u0026#34;red\u0026#34;, \u0026#34;blue\u0026#34;, \u0026#34;green\u0026#34;. themeVariant = \u0026#34;red\u0026#34; Blue variant [params] # Change default color scheme with a variant one. Can be \u0026#34;red\u0026#34;, \u0026#34;blue\u0026#34;, \u0026#34;green\u0026#34;. themeVariant = \u0026#34;blue\u0026#34; Green variant [params] # Change default color scheme with a variant one. Can be \u0026#34;red\u0026#34;, \u0026#34;blue\u0026#34;, \u0026#34;green\u0026#34;. themeVariant = \u0026#34;green\u0026#34; \u0026lsquo;Yours‘ variant First, create a new CSS file in your local static/css folder prefixed by theme (e.g. with mine theme static/css/theme-mine.css). Copy the following content and modify colors in CSS variables.\n:root{ --MAIN-TEXT-color:#323232; /* Color of text by default */ --MAIN-TITLES-TEXT-color: #5e5e5e; /* Color of titles h2-h3-h4-h5 */ --MAIN-LINK-color:#1C90F3; /* Color of links */ --MAIN-LINK-HOVER-color:#167ad0; /* Color of hovered links */ --MAIN-ANCHOR-color: #1C90F3; /* color of anchors on titles */ --MENU-HEADER-BG-color:#1C90F3; /* Background color of menu header */ --MENU-HEADER-BORDER-color:#33a1ff; /*Color of menu header border */ --MENU-SEARCH-BG-color:#167ad0; /* Search field background color (by default borders + icons) */ --MENU-SEARCH-BOX-color: #33a1ff; /* Override search field border color */ --MENU-SEARCH-BOX-ICONS-color: #a1d2fd; /* Override search field icons color */ --MENU-SECTIONS-ACTIVE-BG-color:#20272b; /* Background color of the active section and its childs */ --MENU-SECTIONS-BG-color:#252c31; /* Background color of other sections */ --MENU-SECTIONS-LINK-color: #ccc; /* Color of links in menu */ --MENU-SECTIONS-LINK-HOVER-color: #e6e6e6; /* Color of links in menu, when hovered */ --MENU-SECTION-ACTIVE-CATEGORY-color: #777; /* Color of active category text */ --MENU-SECTION-ACTIVE-CATEGORY-BG-color: #fff; /* Color of background for the active category (only) */ --MENU-VISITED-color: #33a1ff; /* Color of \u0026#39;page visited\u0026#39; icons in menu */ --MENU-SECTION-HR-color: #20272b; /* Color of \u0026lt;hr\u0026gt; separator in menu */ } body { color: var(--MAIN-TEXT-color) !important; } textarea:focus, input[type=\u0026#34;email\u0026#34;]:focus, input[type=\u0026#34;number\u0026#34;]:focus, input[type=\u0026#34;password\u0026#34;]:focus, input[type=\u0026#34;search\u0026#34;]:focus, input[type=\u0026#34;tel\u0026#34;]:focus, input[type=\u0026#34;text\u0026#34;]:focus, input[type=\u0026#34;url\u0026#34;]:focus, input[type=\u0026#34;color\u0026#34;]:focus, input[type=\u0026#34;date\u0026#34;]:focus, input[type=\u0026#34;datetime\u0026#34;]:focus, input[type=\u0026#34;datetime-local\u0026#34;]:focus, input[type=\u0026#34;month\u0026#34;]:focus, input[type=\u0026#34;time\u0026#34;]:focus, input[type=\u0026#34;week\u0026#34;]:focus, select[multiple=multiple]:focus { border-color: none; box-shadow: none; } h2, h3, h4, h5 { color: var(--MAIN-TITLES-TEXT-color) !important; } a { color: var(--MAIN-LINK-color); } .anchor { color: var(--MAIN-ANCHOR-color); } a:hover { color: var(--MAIN-LINK-HOVER-color); } #sidebar ul li.visited \u0026gt; a .read-icon { color: var(--MENU-VISITED-color); } #body a.highlight:after { display: block; content: \u0026#34;\u0026#34;; height: 1px; width: 0%; -webkit-transition: width 0.5s ease; -moz-transition: width 0.5s ease; -ms-transition: width 0.5s ease; transition: width 0.5s ease; background-color: var(--MAIN-LINK-HOVER-color); } #sidebar { background-color: var(--MENU-SECTIONS-BG-color); } #sidebar #header-wrapper { background: var(--MENU-HEADER-BG-color); color: var(--MENU-SEARCH-BOX-color); border-color: var(--MENU-HEADER-BORDER-color); } #sidebar .searchbox { border-color: var(--MENU-SEARCH-BOX-color); background: var(--MENU-SEARCH-BG-color); } #sidebar ul.topics \u0026gt; li.parent, #sidebar ul.topics \u0026gt; li.active { background: var(--MENU-SECTIONS-ACTIVE-BG-color); } #sidebar .searchbox * { color: var(--MENU-SEARCH-BOX-ICONS-color); } #sidebar a { color: var(--MENU-SECTIONS-LINK-color); } #sidebar a:hover { color: var(--MENU-SECTIONS-LINK-HOVER-color); } #sidebar ul li.active \u0026gt; a { background: var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color); color: var(--MENU-SECTION-ACTIVE-CATEGORY-color) !important; } #sidebar hr { border-color: var(--MENU-SECTION-HR-color); } Then, set the themeVariant value with the name of your custom theme file. That\u0026rsquo;s it !\n[params] # Change default color scheme with a variant one. Can be \u0026#34;red\u0026#34;, \u0026#34;blue\u0026#34;, \u0026#34;green\u0026#34;. themeVariant = \u0026#34;mine\u0026#34; "
},
{
	"uri": "http://echotrue.github.io/cont/icons/",
	"title": "Icons and logos",
	"tags": [],
	"description": "",
	"content": "The Learn theme for Hugo loads the Font Awesome library, allowing you to easily display any icon or logo available in the Font Awesome free collection.\nFinding an icon Browse through the available icons in the Font Awesome Gallery. Notice that the free filter is enabled, as only the free icons are available by default.\nOnce on the Font Awesome page for a specific icon, for example the page for the heart, copy the HTML reference and paste into the markdown content.\nThe HTML to include the heart icon is:\n\u0026lt;i class=\u0026quot;fas fa-heart\u0026quot;\u0026gt;\u0026lt;/i\u0026gt;\rIncluding in markdown Paste the \u0026lt;i\u0026gt; HTML into markup and Font Awesome will load the relevant icon.\nBuilt with \u0026lt;i class=\u0026quot;fas fa-heart\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; from Grav and Hugo\rWhich appears as\nBuilt with from Grav and Hugo\nCustomising icons Font Awesome provides many ways to modify the icon\n Change colour (by default the icon will inherit the parent colour) Increase or decrease size Rotate Combine with other icons  Check the full documentation on web fonts with CSS for more.\n"
},
{
	"uri": "http://echotrue.github.io/cont/i18n/",
	"title": "Multilingual and i18n",
	"tags": [],
	"description": "",
	"content": "Learn theme is fully compatible with Hugo multilingual mode.\nIt provides:\n Translation strings for default values (English and French). Feel free to contribute ! Automatic menu generation from multilingual content In-browser language switching  Basic configuration After learning how Hugo handle multilingual websites, define your languages in your config.toml file.\nFor example with current French and English website.\n# English is the default language defaultContentLanguage = \u0026#34;en\u0026#34; # Force to have /en/my-page and /fr/my-page routes, even for default language. defaultContentLanguageInSubdir= true [Languages] [Languages.en] title = \u0026#34;Documentation for Hugo Learn Theme\u0026#34; weight = 1 languageName = \u0026#34;English\u0026#34; [Languages.fr] title = \u0026#34;Documentation du thème Hugo Learn\u0026#34; weight = 2 languageName = \u0026#34;Français\u0026#34; Then, for each new page, append the id of the language to the file.\n Single file my-page.md is split in two files:  in English: my-page.en.md in French: my-page.fr.md   Single file _index.md is split in two files:  in English: _index.en.md in French: _index.fr.md    Be aware that only translated pages are displayed in menu. It\u0026rsquo;s not replaced with default language content.\n\rUse slug Front Matter parameter to translate urls too.\n\rOverwrite translation strings Translations strings are used for common default values used in the theme (Edit this page button, Search placeholder and so on). Translations are available in french and english but you may use another language or want to override default values.\nTo override these values, create a new file in your local i18n folder i18n/\u0026lt;idlanguage\u0026gt;.toml and inspire yourself from the theme themes/hugo-theme-learn/i18n/en.toml\nBy the way, as these translations could be used by other people, please take the time to propose a translation by making a PR to the theme !\nDisable language switching Switching the language in the browser is a great feature, but for some reasons you may want to disable it.\nJust set disableLanguageSwitchingButton=true in your config.toml\n[params] # When using mulitlingual website, disable the switch language button. disableLanguageSwitchingButton = true "
},
{
	"uri": "http://echotrue.github.io/cont/tags/",
	"title": "Tags",
	"tags": ["documentation", "tutorial"],
	"description": "",
	"content": "Learn theme support one default taxonomy of gohugo: the tag feature.\nConfiguration Just add tags to any page:\n--- date: 2018-11-29T08:41:44+01:00 title: Theme tutorial weight: 15 tags: [\u0026#34;tutorial\u0026#34;, \u0026#34;theme\u0026#34;] --- Behavior The tags are displayed at the top of the page, in their insertion order.\nEach tag is a link to a Taxonomy page displaying all the articles with the given tag.\nList all the tags In the config.toml file you can add a shortcut to display all the tags\n[[menu.shortcuts]] name = \u0026#34;\u0026lt;i class=\u0026#39;fas fa-tags\u0026#39;\u0026gt;\u0026lt;/i\u0026gt; Tags\u0026#34; url = \u0026#34;/tags\u0026#34; weight = 30 "
},
{
	"uri": "http://echotrue.github.io/basics/",
	"title": "Basics",
	"tags": [],
	"description": "",
	"content": "Chapter 1 Basics Discover what this Hugo theme is all about and the core-concepts behind it.\n"
},
{
	"uri": "http://echotrue.github.io/cont/",
	"title": "Content",
	"tags": [],
	"description": "",
	"content": "Chapter 2 Content Find out how to create and organize your content quickly and intuitively.\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/",
	"title": "Shortcodes",
	"tags": [],
	"description": "",
	"content": "Hugo uses Markdown for its simple content format. However, there are a lot of things that Markdown doesn’t support well. You could use pure HTML to expand possibilities.\nBut this happens to be a bad idea. Everyone uses Markdown because it\u0026rsquo;s pure and simple to read even non-rendered. You should avoid HTML to keep it as simple as possible.\nTo avoid this limitations, Hugo created shortcodes. A shortcode is a simple snippet inside a page.\nHugo-theme-learn provides multiple shortcodes on top of existing ones.\n\rAttachments\r\rThe Attachments shortcode displays a list of files attached to a page.\n\rButton\r\rNice buttons on your page.\n\rChildren\r\rList the child pages of a page\n\rExpand\r\rDisplays an expandable/collapsible section of text on your page\n\rMermaid\r\rGeneration of diagram and flowchart from text in a similar manner as markdown\n\rNotice\r\rDisclaimers to help you structure your page\n\rSite param\r\rGet value of site params variables in your page.\n\r"
},
{
	"uri": "http://echotrue.github.io/",
	"title": "Axlrose",
	"tags": [],
	"description": "",
	"content": "Hugo learn theme Hugo-theme-learn is a theme for Hugo, a fast and modern static website engine written in Go. Where Hugo is often used for blogs, this multilingual-ready theme is fully designed for documentation.\nThis theme is a partial porting of the Learn theme of Grav, a modern flat-file CMS written in PHP.\nLearn theme works with a page tree structure to organize content : All contents are pages, which belong to other pages. read more about this\n\rMain features  Automatic Search Multilingual mode Unlimited menu levels Automatic next/prev buttons to navigate through menu entries Image resizing, shadow\u0026hellip; Attachments files List child pages Mermaid diagram (flowchart, sequence, gantt) Customizable look and feel and themes variants Buttons, Tip/Note/Info/Warning boxes, Expand  Contribute to this documentation Feel free to update this content, just click the Edit this page link displayed on top right of each page, and pullrequest it\nYour modification will be deployed automatically when merged.\n\rDocumentation website This current documentation has been statically generated with Hugo with a simple command : hugo -t hugo-theme-learn \u0026ndash; source code is available here at GitHub\nAutomatically published and hosted thanks to Netlify. Read more about Automated HUGO deployments with Netlify\n\r"
},
{
	"uri": "http://echotrue.github.io/golang/uint-int/",
	"title": "Uint Int",
	"tags": [],
	"description": "",
	"content": "“一般来说，如果你使用整数，你应该只使用 int 类型。”\n“uint 通常只用于进行二元运算”\n“不要使用无符号类型来强制或建议数字必须是正数。这不是它们的用途。”\n“这是 Go 编程语言所推荐的，当你想要进行按位运算时，uint 的具体示例很有用”\n"
},
{
	"uri": "http://echotrue.github.io/black-hat-go/tcp/",
	"title": "Tcp",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/golang/functional-programming-in-golang/",
	"title": "Functional Programming in Golang",
	"tags": ["函数", "闭包", "函数式选项", "高阶函数"],
	"description": "",
	"content": "Higher-order function Higher-order function又称为高阶函数.高阶函数至少支持以下特性之一:\n 将一个或多个函数作为参数（即过程参数） 返回函数作为其结果  以下为一个使用高阶函数的限流器Demo:\ntype Limiter interface { Limit(key string) bool } type ServerInterceptor func(ctx context.Context) (interface{}, error) func Interceptor(limiter Limiter) ServerInterceptor { return func(ctx context.Context) (interface{}, error) { if limiter.Limit(\u0026#34;k\u0026#34;) { return nil, errors.New(\u0026#34;请求过于频繁\u0026#34;) } return \u0026#34;ok\u0026#34;, nil } } Functional Options Pattern Functional Options Pattern又称函数式选项模式.由于Golang中不支持参数默认值,所以针对一些函数的可选参数没有合适的处理方式.我们可以通过这种方式来构造结构体对象.\ntype Person struct { Name string Age uint8 Gender uint8 } type Option func(*Person) func SetName(n string) Option { return func(o *Person) { o.Name = n } } func SetAge(a uint8) Option { return func(o *Person) { o.Age = a } } func NewPerson(opts ...Option) Person { opt := Person{} for _, o := range opts { o(\u0026amp;opt) } return opt } Closure Function 在Golang中函数被看作是第一类值,这就意味着函数像变量一样有类型,有值.\n 函数变量的零值是nil. 这意味着它可以和nil进行比较.但两个函数变量之间不能比较 调用nil的函数变量会导致报错  type f func() func main() { var a f if a == nil { fmt.Println(\u0026#34;空函数\u0026#34;) } else { a() } } 什么是闭包 闭包是匿名函数与匿名函数所引用环境的组合。匿名函数有动态创建的特性，该特性使得匿名函数不用通过参数传递的方式，就可以直接引用外部的变量。这就类似于常规函数直接使用全局变量一样.\nfunc incr() func() int { var x int return func() int { x++ return x } } func main() { i := incr() fmt.Println(i()) fmt.Println(i()) fmt.Println(i()) } 通过i:=incr()把incr函数的返回值(func() int 类型的函数)赋值给i,i就是一个闭包.i中有着指向x地址的指针.所以调用i()会修改x的值.因此,以上代码会输出1,2,3\nfunc main() { x := 1 func() { fmt.Println(\u0026amp;x) }() fmt.Println(\u0026amp;x) } 以上会输出0xc00000a0b8,0xc00000a0b8.这也再次证明了闭包中保存着外部变量的地址\n循环中的闭包 func main() { var dummy [3]int var f func() for i := 0; i \u0026lt; len(dummy); i++ { f = func() { println(i) } } f() // 3 } 以上代码输出3 . 由于闭包f可以访问i的引用,而i实际加到3的时候由于不满足i \u0026lt; len(dumy)而结束循环 . 因此调用f()的时候通过解i的引用得到的值是3. 如果使用for range 则不会输出3\nfunc main() { var dummy [3]int var f func() for i := range dummy{ f = func() { println(i) } } f() // 3 } 另外一个例子:\nfunc main() { var funcSlice []func() for i := 0; i \u0026lt; 3; i++ { funcSlice = append(funcSlice, func() { println(i) }) } for j := 0; j \u0026lt; 3; j++ { funcSlice[j]() } } 通常为了避免以上问题,可以声明一个新的局部变量j:=i,且把之后对i的操作改为对j的操作改为对j的.也可以通过声明新的匿名函数,并将i作为参数传递进去.由于Golang函数参数是按值传递,所以每个闭包函数可以独立引用传进来的参数\n匿名函数小知识点 匿名函数的调用 函数体后面的()表示直接执行当前函数\ni := 1 f := func() { i += 2 } f() fmt.Println(i) 以上代码等同于\ni := 1 func() { i += 2 }() fmt.Println(i) 匿名函数传参 将匿名函数赋值给变量使用时\ni := 1 f := func(n int) { fmt.Println(n) } f(i) 直接执行匿名函数时,这里的m,n为形参 . 2,2为实参\ni := 1 func(m, n int) { i = i + m + n }(2, 2) fmt.Println(i) "
},
{
	"uri": "http://echotrue.github.io/categories/go/",
	"title": "Go",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E5%87%BD%E6%95%B0/",
	"title": "函数",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E9%80%89%E9%A1%B9/",
	"title": "函数式选项",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E9%97%AD%E5%8C%85/",
	"title": "闭包",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/",
	"title": "高阶函数",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/game/combat-system/",
	"title": "Combat System",
	"tags": [],
	"description": "",
	"content": "加载英雄,怪物,宠物等等到状态机的soldiers属性\n$this-\u0026gt;loader-\u0026gt;load(); 逐个初始化soldiers.挂载主动,被动技能效果并添加监听事件到observers属性. 保留原始属性\n触发EVENT_CREATED事件.事件id为1的技能效果将会被加载.该类型的技能效果是永久加成效果.observers的数据格式为:\n{\u0026#34;3\u0026#34;:[53102,53103,312],\u0026#34;9\u0026#34;:[53104],\u0026#34;4\u0026#34;:[53105],\u0026#34;5\u0026#34;:[53106]} 计算英雄被动属性差值diff_addition\n计算队伍加成属性,并赋值到soldier的addition属性.\n附加效果加成计算\n累加加成效果数据到soldier\n检查并削弱基础属性\n处理残血模式下血量\n处理蓝量\n保存属性值到英雄基础属性对象base\n"
},
{
	"uri": "http://echotrue.github.io/game/game-vocabulary-list/",
	"title": "Game Vocabulary List",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/game/turn-based-game-with-go/",
	"title": "Turn-Based Game With Go【译】",
	"tags": [],
	"description": "",
	"content": " Today we will talk about how to write a simple turn-based game engine with Go. While writing our character’s abilities and fights with each other, we will use Interfaces,channels, and concurrency with Golang\n 今天我们将讨论下如何使用Golang编写一个简单的基于回合制的游戏引擎.在实现角色的能力和与其他角色战斗的功能时，我们会使用到Golang的Interface,channels,concurrency等特性。\n If you don’t have any idea about the turn-based game, it is about the different types of characters with different strengths, and different abilities fight and kill each other one by one. The winner is the survived last person.\n 如果你对回合制游戏一无所知，这里可以简单概括下。回合制游戏就是拥有不同力量，不同能力的各类角色之间互相战斗并逐个杀死对方. 获胜者是最后的幸存者。\nTurn Game Rules   Fights mean every Warrier hit only the one Warrier in Turn. Every attacker loses stamina or mana after hit to an opponent.   战斗意味着每个战士每个回合只能攻击一个战士。每一个攻击者在击中对手后会失去体力值或者魔法值.\n Every Hit damage is changed by Warrier’s Level and his Weapon, Magic, or Animal kind.   每一次命中的伤害会因战士的等级，武器，法力，或者宠物类型而不同\n When a warrior is damaged by someone else, his or her blood will decreases. If the blood value is zero or less, he will die.   当一个战士被其他人伤害时，他的血量会减少，如果血量值降到0或者更少，他将会死亡.\n If a warrior’s stamina or mana less than zero, he can’t hit or make magic until the next Turn. Next Turn, his mana or stamina will be full.   如果一个战士的体力或者魔法值少于0，在下一回合之前他将不能施放技能。下一回合他的体力或者魔法值将会充满。\n Firstly let’s create base traits struct of these types of characters.\n 首先,创建不同角色的基础属性结构体\n heroCharacter/heroCharacter.go: All the characters have Name, Level (experience),Attacks(Damage List) and Blood(Energy)\n 所有的角色都有角色名称，等级（经验），攻击力（伤害列表）和血量（能量）\npackage heroCharacter type Hero struct { Name string Level int Attacks map[string]int Blood int }  Let’s Create all Characters Interface. We will list all character’s common Actions in this interface.\n 创建角色interface,在这个接口中我们将定义所有角色通用的操作行为的方法。\n fightHero/fightHero.go: Every hero Hits the other characters, takes Damage after attacked by someone else. We can get info about him or her healthy, stamina or mana.And finally, we can check he or she died or not. These are the common functions of all Characters.\n 每个英雄角色击中其他角色，或者收到其他人的攻击。我们会获取他的健康，魔法或者体力信息.然后,检查他是否死亡.这是所有角色的通用方法。\npackage fightHero type FightHero interface { Hit() int TakeDamage(damage int) GetInfo() (string, int) IsDeath() bool } Wizard  Let’s create first character Wizard.\n 创建第一个角色男巫\nwizard/wizard.go:\nproperties of Wizard type( Wizard struct{ hero.Hero Manas map[string]int Mana int Magic string } )  Hero: Common character’s properties.\n Hero:角色通用属性\n Manas: This is a collection of “string” magic names with their “int” mana costs.Example: “Manas: map[string]int{“FireBall”: 5, “Thunder”: 10, “Ghost Attack”:30}}”\n Manas：魔法值消耗列表.魔法技能名称作为key,魔法技能消耗的魔法值作为value.示例中火球技能消耗5点魔法值,闪电技能消耗10点,幽灵攻击消耗30点\n Mana: This is integer Wizard’s mana value. Wizard needs mana, for making Magic.Without mana Wizard is nothing :)\n Mana:魔法值,男巫的魔法值,男巫需要魔法值来施放魔法技能.没有魔法值,男巫啥也不是.\n Magic: This is Wizard’s weapon. He or she can hit an enemy with the Magic. Example: “map[string]int{“FireBall”: 25, “Thunder”: 18, “Ghost Attack”: 30}”\n Magic: 这是男巫的武器,他可以使用魔法技能攻击敌人.\nAction of Wizard FightHero interface Methods: Hit()计算魔法技能伤害值,只有法力值足够的前提下才能施放魔法技能,魔法技能的伤害值和等级有关系.\nfunc (w Wizard) Hit() int { if w.Mana \u0026gt;= w.Manas[w.Magic] { levelEffect := int(math.Ceil(float64(w.Level) * 0.1)) return w.Attacks[w.Magic] + levelEffect } return 0 } TakeDamage 如果被其他角色攻击,血量将会减少,当血量为0时,男巫就会死亡.此处使用了指针类型*Wizard,因为当男巫受到伤害时必须及时减少男巫的血量\nfunc (w *Wizard) TakeDamage(damage int) { w.Blood = w.Blood - damage } GetInfo() 获取男巫的名称和血量\nIsDeath(): 检测男巫是否死亡\nWizard Own Methods: GetMana(): 获取男巫当前的法力值\nSpendMana() 消耗男巫的法力值\nCreateWizard() 创建男巫对象\nFighter (参考男巫) Druid (参考男巫) Fight (战斗) 我们已经定义了所有的英雄角色,现在开始让他们之间互相战斗,他们中只有一个能获胜幸存下来. 定义全局变量和随机函数:\nvar fighterList map[string]IHero.FightHero var fighterNumberList map[int]IHero.FightHero func GetRandomID(limit int) int { rand.Seed(time.Now().UnixNano()) rndVictim := rand.Intn(limit) + 1 return rndVictim } func GetRandomBetweenID(minLimit int, maxlimit int) int { rand.Seed(time.Now().UnixNano()) rndVictim := rand.Intn(maxlimit-minLimit) + minLimit + 1 return rndVictim } var isFighterDead bool = false var isWizardDead bool = false var isDruidDead bool = false var TotalLive int = 3 func MapRandomKeyGet(mapI interface{}) interface{} { keys := reflect.ValueOf(mapI).MapKeys() return keys[rand.Intn(len(keys))].Interface() }  fighterList以英雄的名称保存英雄信息 fighterNumberList根据英雄ID存储英雄名称 GetRandomID 获取随机数 GetRandomBetweenID 给定范围内获取随机数 isFighterDead, isWizardDead, isDruidDead 每个英雄的生死状态 TotalLive 几条生命 MapRandomKeyGet 用来随机获取Wizzard的魔法技能,Fighter的武器,Druid的宠物  "
},
{
	"uri": "http://echotrue.github.io/golang/binary-an-bit-operation/",
	"title": "Binary an Bit Operation",
	"tags": [],
	"description": "",
	"content": "fmt.Printf(\u0026#34;%d（%08b）左移1位：%d ,左移2位: %d \\n\u0026#34;, 0, 0, 0\u0026lt;\u0026lt;1, 0\u0026lt;\u0026lt;2) fmt.Printf(\u0026#34;%d（%08b）左移1位：%d ,左移2位: %d \\n\u0026#34;, 1, 1, 1\u0026lt;\u0026lt;1, 1\u0026lt;\u0026lt;2) fmt.Printf(\u0026#34;%d（%08b）左移1位：%d ,左移2位: %d \\n\u0026#34;, 2, 2, 2\u0026lt;\u0026lt;1, 2\u0026lt;\u0026lt;2) fmt.Printf(\u0026#34;%d（%08b）左移1位：%d ,左移2位: %d \\n\u0026#34;, 3, 3, 3\u0026lt;\u0026lt;1, 3\u0026lt;\u0026lt;2) fmt.Printf(\u0026#34;%d右移1位：%d ,右移2位: %d \\n\u0026#34;, 0, 0\u0026gt;\u0026gt;1, 0\u0026gt;\u0026gt;2) fmt.Printf(\u0026#34;%d右移1位：%d ,右移2位: %d \\n\u0026#34;, 1, 1\u0026gt;\u0026gt;1, 1\u0026gt;\u0026gt;2) fmt.Printf(\u0026#34;%d右移1位：%d ,右移2位: %d \\n\u0026#34;, 2, 2\u0026gt;\u0026gt;1, 2\u0026gt;\u0026gt;2) fmt.Printf(\u0026#34;%d右移1位：%d ,右移2位: %d \\n\u0026#34;, 3, 3\u0026gt;\u0026gt;1, 3\u0026gt;\u0026gt;2) "
},
{
	"uri": "http://echotrue.github.io/tags/go/",
	"title": "Go",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/golang/lock/",
	"title": "Lock",
	"tags": ["Go", "lock"],
	"description": "",
	"content": "检测Go程序中按值传递的 locks "
},
{
	"uri": "http://echotrue.github.io/tags/lock/",
	"title": "lock",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/categories/lock/",
	"title": "lock",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/golang/make-and-new/",
	"title": "Golang make and new",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/about/",
	"title": "About",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/panic/",
	"title": "panic",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/categories/panic/",
	"title": "panic",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/golang/panic-and-recover/",
	"title": "Panic and Recover",
	"tags": ["Go", "panic"],
	"description": "",
	"content": "panic  Golang 中常见的错误处理方式是返回error给调用者。通常error使用场景是发生了逻辑错误。但是，如果是无法恢复的错误，可以选择使用panic。panic可以主动触发。也可以被动触发（例如：数组越界）。\n panic会停掉当前正在执行的程序，与os.Exit(-1)不同的是：panic会有序的撤退，它会先处理完当前goroutine已经defer的任务，然后再退出整个程序。\nfunc main() { var user = os.Getenv(\u0026quot;USER_\u0026quot;) go func() { defer func() { fmt.Println(\u0026quot;defer 1\u0026quot;) }() if user == \u0026quot;\u0026quot;{ panic(\u0026quot;should set user env.\u0026quot;) } }() time.Sleep(1*time.Second) fmt.Println(\u0026quot;get result\u0026quot;) }  上述代码输出：\ndefer 1 panic: should set user env. goroutine 19 [running]: main.main.func1(0x0, 0x0) D:/gopath/src/race_condition/index.go:16 +0x86 created by main.main D:/gopath/src/race_condition/index.go:11 +0x59 Process finished with exit code 2 说明panic坚守了自己的原则：执行且只执行当前goroutine的defer，defer的特点是LIFO，即后进先出。如果有多个defer的时候，会倒序执行\nrecover  有时候不希望因为panic导致整个进程终止，因此需要像其他语言捕获异常。在Golang中可以通过在当前goroutine的defer中使用recover来捕获panic。recover只在defer的函数中有效，如果不是在defer上下文中调用，recover会直接返回nil\n"
},
{
	"uri": "http://echotrue.github.io/golang/golang-select/",
	"title": "Golang Select",
	"tags": ["Go"],
	"description": "",
	"content": "什么是select select语句用于从多个发送/接收channel中进行选择的操作。 select语句将阻塞直到其中一个发送/接收操作准备就绪。如果有多个操作就绪，则随机选择其中一个操作。语法类似于switch，只是每个case语句被一个channel操作取代了。让我们深入研究一些代码，以便更好地理解\nfunc server1(ch chan string) { time.Sleep(6 * time.Second) ch \u0026lt;- \u0026quot;from server1\u0026quot; } func server2(ch chan string) { time.Sleep(3 * time.Second) ch \u0026lt;- \u0026quot;from server2\u0026quot; } func main() { output1 := make(chan string) output2 := make(chan string) go server1(output1) go server2(output2) select { case s1 := \u0026lt;-output1: fmt.Println(s1) case s2 := \u0026lt;-output2: fmt.Println(s2) } } 在上面的程序中，在第 8 行server1函数休眠 6 秒然后将文本从server1写入channel ch。第 12 行server2函数休眠 3 秒，然后从server2写入channel ch。\nmain函数在 20 和 21 行分别调用server1和server2。\n在第 22 行，select语句将阻塞直到其中一个case准备就绪。在上面的程序中，server1在 6 秒后写入output1 channel，而server2在 3 秒后写入output2 channel。因此 select 语句将阻塞 3 秒并等待server2写入。 3 秒后，程序将打印，\nfrom server2 然后终止。\nselect的用途 将上述程序中的函数命名为server1和server2的原因是为了说明select的实际用途。\n让我们假设我们有一个关键任务的应用，我们需要尽快将输出返回给用户。该应用程序的数据库被复制并存储在世界各地的不同服务器中。假设函数server1和server2实际上与 2 个这样的服务器通信。每个服务器的响应时间取决于每个服务器的负载和网络延迟。我们将请求发送到两个服务器，然后使用select语句在相应的channel上等待响应。select会选择优先响应的服务器，其他响应被忽略。这样我们就可以向多个服务器发送相同的请求，并将最快的响应返回给用户:)。\n默认case 当其他case都没有准备就绪时，将会执行select语句中的默认case。这通常用于防止select语句阻塞。\nfunc process(ch chan string) { time.Sleep(10500 * time.Millisecond) ch \u0026lt;- \u0026quot;process successful\u0026quot; } func main() { ch := make(chan string) go process(ch) for { time.Sleep(1000 * time.Millisecond) select { case v := \u0026lt;-ch: fmt.Println(\u0026quot;received value: \u0026quot;, v) return default: fmt.Println(\u0026quot;no value received\u0026quot;) } } } 在上面的程序中，在第 8 行process函数休眠 10500 毫秒（10.5 秒），然后将process successful写入ch channel。该函数在第 15 行被并发调用。\n在并发调用process Goroutine之后，main Goroutine中启动了无限循环。无限循环在每次迭代开始期间休眠 1000 毫秒（1 秒），并执行select操作。在前 10500 毫秒期间，select语句的第一种情况即case v：= \u0026lt;-ch：将不会准备就绪，因为process Goroutine仅在 10500 毫秒后才写入ch channel。因此，在此期间将执行defualt分支，程序将会打印 10 次no value received。\n在 10.5 秒之后，process Goroutine将process successful写入ch。 现在将执行select语句的第一种情况，程序将打印received value: process successful然后程序终止。该程序将输出，\nno value received no value received no value received no value received no value received no value received no value received no value received no value received no value received received value: process successful 死锁和默认case func main() { ch := make(chan string) select { case \u0026lt;-ch: } } 在上面的程序中，我们在第一行创建了一个channel ch。我们尝试从选择的这个channel读取。而这个select语句将一直阻塞，因为没有其他Goroutine写入此channel，因此将导致死锁。该程序将在运行时产生panic同时打印，\nfatal error: all goroutines are asleep - deadlock! goroutine 1 [chan receive]: main.main() /tmp/sandbox416567824/main.go:6 +0x80 如果存在默认case，则不会发生此死锁，因为在没有其他case准备就绪时将执行默认case。上面的程序可以重写。\nfunc main() { ch := make(chan string) select { case \u0026lt;-ch: default: fmt.Println(\u0026quot;default case executed\u0026quot;) } } 输出，\ndefault case executed 类似地，当select只有一个nil channel，也会执行默认case。\nfunc main() { var ch chan string select { case v := \u0026lt;-ch: fmt.Println(\u0026quot;received value\u0026quot;, v) default: fmt.Println(\u0026quot;default case executed\u0026quot;) } } 在上面的程序中，ch是nil，我们试图用select从ch中读取。如果没有默认case，则select将一直被阻塞并导致死锁。由于我们在select中有一个默认的case，它将被执行并且程序将打印，\ndefault case executed select的随机性 当select语句中的多个case准备就绪时，将会随机挑选一个执行。\nfunc server1(ch chan string) { ch \u0026lt;- \u0026quot;from server1\u0026quot; } func server2(ch chan string) { ch \u0026lt;- \u0026quot;from server2\u0026quot; } func main() { output1 := make(chan string) output2 := make(chan string) go server1(output1) go server2(output2) time.Sleep(1 * time.Second) select { case s1 := \u0026lt;-output1: fmt.Println(s1) case s2 := \u0026lt;-output2: fmt.Println(s2) } } 在上面的程序中，server1和server2 协程在第 18 和 19 行分别被调用，然后main协程休眠 1 秒。当运行到select语句时，server1已将from server1写入output1，server2已将from server2写入output2，因此select语句中的两种情况都准备就绪。如果多次运行此程序，将会随机输出from server1或from server2。\n空select func main() { select {} } 你认为上面的程序将会输出什么？\n我们知道select语句将被阻塞，直到执行其中一个case。在这种情况下，select语句没有任何case，因此它将一直阻塞导致死锁。这个程序将会产生panic，并输出，\nfatal error: all goroutines are asleep - deadlock! goroutine 1 [select (no cases)]: main.main() /tmp/sandbox299546399/main.go:4 +0x20 "
},
{
	"uri": "http://echotrue.github.io/tags/documentation/",
	"title": "documentation",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/tutorial/",
	"title": "tutorial",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/golang/addressable/",
	"title": "Addressable and Unaddressable-Value",
	"tags": ["Go"],
	"description": "",
	"content": "Addressable "
},
{
	"uri": "http://echotrue.github.io/tags/array/",
	"title": "array",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/shortcodes/attachments/",
	"title": "Attachments",
	"tags": [],
	"description": "The Attachments shortcode displays a list of files attached to a page.",
	"content": "The Attachments shortcode displays a list of files attached to a page.\n\r\rAttachments\r\r\rBachGavotteShort.mp3\r\r(357 ko)\r\r\rCarroll_AliceAuPaysDesMerveilles.pdf\r\r(175 ko)\r\r\radivorciarsetoca00cape.pdf\r\r(361 ko)\r\r\rhugo.png\r\r(17 ko)\r\r\rmovieselectricsheep-flock-244-32500-2.mp4\r\r(340 ko)\r\r\r\rUsage The shortcurt lists files found in a specific folder. Currently, it support two implementations for pages\n  If your page is a markdown file, attachements must be place in a folder named like your page and ending with .files.\n  content  _index.md page.files  attachment.pdf   page.md       If your page is a folder, attachements must be place in a nested \u0026lsquo;files\u0026rsquo; folder.\n  content  _index.md page  index.md files  attachment.pdf           Be aware that if you use a multilingual website, you will need to have as many folders as languages.\nThat\u0026rsquo;s all !\nParameters    Parameter Default Description     title \u0026ldquo;Attachments\u0026rdquo; List\u0026rsquo;s title   style \u0026quot;\u0026quot; Choose between \u0026ldquo;orange\u0026rdquo;, \u0026ldquo;grey\u0026rdquo;, \u0026ldquo;blue\u0026rdquo; and \u0026ldquo;green\u0026rdquo; for nice style   pattern \u0026ldquo;.*\u0026rdquo; A regular expressions, used to filter the attachments by file name. The pattern parameter value must be regular expressions.    For example:\n To match a file suffix of \u0026lsquo;jpg\u0026rsquo;, use *.jpg (not *.jpg). To match file names ending in \u0026lsquo;jpg\u0026rsquo; or \u0026lsquo;png\u0026rsquo;, use .*(jpg|png)  Examples List of attachments ending in pdf or mp4 {{%attachments title=\u0026quot;Related files\u0026quot; pattern=\u0026quot;.*(pdf|mp4)\u0026quot;/%}}\r renders as\n\r\rRelated files\r\r\rCarroll_AliceAuPaysDesMerveilles.pdf\r\r(175 ko)\r\r\radivorciarsetoca00cape.pdf\r\r(361 ko)\r\r\rmovieselectricsheep-flock-244-32500-2.mp4\r\r(340 ko)\r\r\r\rColored styled box {{%attachments style=\u0026quot;orange\u0026quot; /%}}\r renders as\n\r\rAttachments\r\r\rBachGavotteShort.mp3\r\r(357 ko)\r\r\rCarroll_AliceAuPaysDesMerveilles.pdf\r\r(175 ko)\r\r\radivorciarsetoca00cape.pdf\r\r(361 ko)\r\r\rhugo.png\r\r(17 ko)\r\r\rmovieselectricsheep-flock-244-32500-2.mp4\r\r(340 ko)\r\r\r\r{{%attachments style=\u0026quot;grey\u0026quot; /%}}\r renders as\n\r\rAttachments\r\r\rBachGavotteShort.mp3\r\r(357 ko)\r\r\rCarroll_AliceAuPaysDesMerveilles.pdf\r\r(175 ko)\r\r\radivorciarsetoca00cape.pdf\r\r(361 ko)\r\r\rhugo.png\r\r(17 ko)\r\r\rmovieselectricsheep-flock-244-32500-2.mp4\r\r(340 ko)\r\r\r\r{{%attachments style=\u0026quot;blue\u0026quot; /%}}\r renders as\n\r\rAttachments\r\r\rBachGavotteShort.mp3\r\r(357 ko)\r\r\rCarroll_AliceAuPaysDesMerveilles.pdf\r\r(175 ko)\r\r\radivorciarsetoca00cape.pdf\r\r(361 ko)\r\r\rhugo.png\r\r(17 ko)\r\r\rmovieselectricsheep-flock-244-32500-2.mp4\r\r(340 ko)\r\r\r\r{{%attachments style=\u0026quot;green\u0026quot; /%}}\r renders as\n\r\rAttachments\r\r\rBachGavotteShort.mp3\r\r(357 ko)\r\r\rCarroll_AliceAuPaysDesMerveilles.pdf\r\r(175 ko)\r\r\radivorciarsetoca00cape.pdf\r\r(361 ko)\r\r\rhugo.png\r\r(17 ko)\r\r\rmovieselectricsheep-flock-244-32500-2.mp4\r\r(340 ko)\r\r\r\r"
},
{
	"uri": "http://echotrue.github.io/golang/block-forever-in-go/",
	"title": "Block forever in go",
	"tags": ["Go"],
	"description": "",
	"content": "Golang中永久阻塞的不同方法 The current design of Go’s runtime assumes that the programmer is responsible for detecting when to terminate a goroutine and when to terminate the program. A program can be terminated in a normal way by calling os.Exit or by returning from the main() function. There are a lot of ways of blocking runtime forever, I will show all of them for better understanding of blocking in Go.\n1. Using sync.WaitGroup Wait blocks until the WaitGroup counter is zero.\npackage main import \u0026quot;sync\u0026quot; func main() { var wg sync.WaitGroup wg.Add(1) wg.Wait() } 2. Empty select An empty select{} statement blocks indefinitely i.e. forever. It is similar and in practice equivalent to an empty for{} statement.\npackage main func main() { select{} } 3. Infinite loop The easiest way which will use 100% of CPU.\npackage main func main() { for {} } 4. Using sync.Mutex If the lock is already in use, the calling goroutine blocks until the mutex is available.\npackage main import \u0026quot;sync\u0026quot; func main() { var m sync.Mutex m.Lock() m.Lock() } 5. Empty Channel Empty channels will block until there is something to receive.\npackage main func main() { c := make(chan struct{}) \u0026lt;-c } 6. Nil Channel Works for channels created without make.\npackage main func main() { var c chan struct \u0026lt;-c } Conclusion I have found 6 ways to block a Go program. It can be useful when you start multiple goroutines in a main() function and don’t want to terminate a whole program after that. But some of these examples are just for fun.\nIf you know another way - please share it in comments, I will add it here.\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/button/",
	"title": "Button",
	"tags": [],
	"description": "Nice buttons on your page.",
	"content": "A button is a just a clickable button with optional icon.\n{{% button href=\u0026quot;https://getgrav.org/\u0026quot; %}}Get Grav{{% /button %}}\r{{% button href=\u0026quot;https://getgrav.org/\u0026quot; icon=\u0026quot;fas fa-download\u0026quot; %}}Get Grav with icon{{% /button %}}\r{{% button href=\u0026quot;https://getgrav.org/\u0026quot; icon=\u0026quot;fas fa-download\u0026quot; icon-position=\u0026quot;right\u0026quot; %}}Get Grav with icon right{{% /button %}}\r\rGet Grav\r\r\rGet Grav with icon\r\rGet Grav with icon right\r\r\r"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/",
	"title": "Children",
	"tags": [],
	"description": "List the child pages of a page",
	"content": "Use the children shortcode to list the child pages of a page and the further descendants (children\u0026rsquo;s children). By default, the shortcode displays links to the child pages.\nUsage    Parameter Default Description     page current Specify the page name (section name) to display children for   style \u0026ldquo;li\u0026rdquo; Choose the style used to display descendants. It could be any HTML tag name   showhidden \u0026ldquo;false\u0026rdquo; When true, child pages hidden from the menu will be displayed   description \u0026ldquo;false\u0026rdquo; Allows you to include a short text under each page in the list.when no description exists for the page, children shortcode takes the first 70 words of your content. read more info about summaries on gohugo.io   depth 1 Enter a number to specify the depth of descendants to display. For example, if the value is 2, the shortcode will display 2 levels of child pages. Tips: set 999 to get all descendants   sort none Sort Children ByWeight- to sort on menu orderName- to sort alphabetically on menu labelIdentifier- to sort alphabetically on identifier set in frontmatterURL- URL    Demo {{% children %}}  \rpage 1\r\r\rpage 2\r\r\rpage 3\r\r\rpage 4\r\r\rpage test\r\r\r{{% children description=\u0026quot;true\u0026quot; %}}  "
},
{
	"uri": "http://echotrue.github.io/tags/concurrency-safety/",
	"title": "concurrency-safety",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/context/",
	"title": "context",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/shortcodes/expand/",
	"title": "Expand",
	"tags": [],
	"description": "Displays an expandable/collapsible section of text on your page",
	"content": "The Expand shortcode displays an expandable/collapsible section of text on your page. Here is an example\n\r\rExpand me...\r\r\rLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n\r Usage this shortcode takes exactly one optional parameter to define the text that appears next to the expand/collapse icon. (default is \u0026ldquo;Expand me\u0026hellip;\u0026quot;)\n{{%expand \u0026quot;Is this learn theme rocks ?\u0026quot; %}}Yes !.{{% /expand%}}\r \r\rIs this learn theme rocks ?\r\r\rYes !\r\r Demo {{%expand%}}\rLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod\rtempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,\rquis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\rconsequat. Duis aute irure dolor in reprehenderit in voluptate velit esse\rcillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non\rproident, sunt in culpa qui officia deserunt mollit anim id est laborum.\r{{% /expand%}}\r \r\rExpand me...\r\r\rLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n\r "
},
{
	"uri": "http://echotrue.github.io/golang/channel/",
	"title": "Golang channel",
	"tags": ["Go"],
	"description": "",
	"content": "概念  从字面上看，channel的意思大概就是管道的意思。channel是一种goroutine用以接收或发送消息的安全的消息队列，channel就像两个goroutine之间的导管，来实现各种资源的同步。在官方Effective go文档中有一句非常著名的话可以说明channel在使用Golang进行并发编程的时候扮演了极为重要的角色\n Do not communicate by sharing memory; instead, share memory by communicating.\n Channel类型 readOnlyCh := make(\u0026lt;-chan int)//表示一个元素类型为T的单向接收通道类型。 编译器不允许向此类型的值中发送数据。 writeOnlyCh := make(chan\u0026lt;- int)//表示一个元素类型为T的单向发送通道类型。 编译器不允许从此类型的值中接收数据 readWriteCh := make(chan int)//表示一个元素类型为T的双向通道类型。 编译器允许从此类型的值中接收和向此类型的值中发送数据 阻塞  根据Channel缓冲区的大小，我们又可以将Channel分为Unbuffered channels与Buffered channels。其中，Unbuffered channels的缓冲区大小为0，这种channel的接收者会阻塞直至接收到消息，发送者会阻塞直至接收者接收到消息，这种机制可以用于两个goroutine进行状态同步。Buffered channels拥有缓冲区，当缓冲区已满时，发送者会阻塞；当缓冲区为空时，接收者会阻塞。引用The Nature Of Channels In Go中的两张图片来说明两种channel的特性。\n Unbuffered Channels   Buffered Channels  基本用法 ch := make(chan string) go func() { ch \u0026lt;- \u0026quot;hello\u0026quot; }() msg := \u0026lt;-ch fmt.Println(msg)  以上代码，利用不带缓冲的channel双向阻塞的特性。主goroutine(就是main函数)会阻塞直到接收到子goroutine向ch中写入的值。所以保证了hello一定会输出。\n利用Channel实现并发的同步  基本用法中的代码片段使用阻塞接收的方式，实现了主goroutine等待子goroutine完成。最终达到了两个goroutine的同步。使用WaitGroup同样能达到多个goroutine的同步，尤其是需要等待多个协程的情况下，WaitGroup会是更好的选择。\nfunc worker(i int, wg *sync.WaitGroup) { defer wg.Done() time.Sleep(time.Second) fmt.Printf(\u0026quot;worker %d stared\\n\u0026quot;, i) } func main() { var wg sync.WaitGroup for i := 1; i \u0026lt;= 5; i++ { wg.Add(1) go worker(i, \u0026amp;wg) } wg.Wait() } 执行结果：\nworker 1 stared worker 5 stared worker 4 stared worker 3 stared worker 2 stared Channel 选择器  select语句主要用在从多个读或者写channel的操作中进行选择。select语句会一直阻塞直到，有至少一个读或者写channel操作就绪。如果同时有多个操作准备就绪，select语句会随机选择其中一个执行。select语法类似switch，每个case相当于一个通道操作。\nc1 := make(chan string) c2 := make(chan string) go func() { time.Sleep(1 * time.Second) c1 \u0026lt;- \u0026quot;one\u0026quot; }() go func() { time.Sleep(1 * time.Second) c2 \u0026lt;- \u0026quot;two\u0026quot; }() for i := 0; i \u0026lt; 2; i++ { select { case msg1 := \u0026lt;-c1: fmt.Printf(\u0026quot;接到消息：%s\\n\u0026quot;, msg1) case msg2 := \u0026lt;-c2: fmt.Printf(\u0026quot;接到消息：%s\\n\u0026quot;, msg2) } } 以上代码会输出：接到消息one，接到消息two。\nChannel遍历 for...range可以用来遍历通道，它会反复从通道接收数据直到通道关闭。\nqueue := make(chan string, 2) queue \u0026lt;- \u0026quot;one\u0026quot; queue \u0026lt;- \u0026quot;two\u0026quot; close(queue) for elem := range queue { fmt.Println(elem) } Channel 的关闭  内置函数close()可以用来关闭channel,close()函数只能关闭可读写或者只写的通道。通道的关闭通常应该遵循一定的原则：由生产者（发送者）来关闭，保证不关闭已关闭的通道(或向已关闭的通道发送值)。\nch := make(chan string) //可以关闭的通道 ch := make(chan\u0026lt;- string) //可以关闭的通道 ch := make(\u0026lt;-chan string) //不能关闭的通道 1、关闭 一个通道意味着不能再向这个通道发送值了。 该特性可以向通道的接收方传达工作已经完成的信息。\nmsg := make(chan string) done := make(chan bool) go func() { for { select { case m, ok := \u0026lt;-msg: if ok { fmt.Printf(m) } else { fmt.Println(\u0026quot;All message has received.\u0026quot;) done \u0026lt;- true return } } } }() for i := 1; i \u0026lt; 4; i++ { msg \u0026lt;- fmt.Sprintf(\u0026quot;Message %d\\n\u0026quot;, i) } close(msg) \u0026lt;-done 2、向一个已经关闭的channel发送数据会panic\n3、从一个已经关闭的通道中读数据，依然可以读到数据。读到的内容是通道元素类型所对应的的零值。（例如：int类型channel读到的是0）。\nch := make(chan int) dataCh := make(chan string) go func() { dataCh \u0026lt;- \u0026quot;str one\u0026quot; dataCh \u0026lt;- \u0026quot;str two\u0026quot; close(dataCh) }() go func() { for { time.Sleep(time.Millisecond * 500) select { case str := \u0026lt;-dataCh: fmt.Println(\u0026quot;--\u0026gt;\u0026quot;,str) } } }() \u0026lt;-ch //输出： --\u0026gt; str one --\u0026gt; str two --\u0026gt; --\u0026gt; 4、当发送者关闭通道后，通道接收器可以通过向接收表达式分配第二个参数来判断通道是否关闭。c,ok := \u0026lt;-ch，如果没有更多的值要接受且通道已经关闭，ok为false\nch := make(chan int) dataCh := make(chan string) go func() { dataCh \u0026lt;- \u0026quot;str one\u0026quot; dataCh \u0026lt;- \u0026quot;str two\u0026quot; close(dataCh) }() go func() { for { time.Sleep(time.Millisecond * 500) select { case str, ok := \u0026lt;-dataCh: if ok { fmt.Println(\u0026quot;--\u0026gt;\u0026quot;, str) } else { fmt.Println(\u0026quot;通道已关闭\u0026quot;) ch \u0026lt;- 1 return } } } }() \u0026lt;-ch channel的基本操作和注意事项 channel存在3种状态：\n nil，未初始化的状态，只进行了声明，或者手动赋值为nil active，正常的channel，可读或者可写 closed，已关闭，千万不要误认为关闭channel后，channel的值是nil  channel可进行3种操作：\n 读 写 关闭  把这3种操作和3种channel状态可以组合出9种情况：\n   操作 nil的channel 正常channel 已关闭channel     \u0026lt;- ch 阻塞 成功或阻塞 读到零值   ch \u0026lt;- 阻塞 成功或阻塞 panic   close(ch) panic 成功 panic    "
},
{
	"uri": "http://echotrue.github.io/golang/data-races/",
	"title": "Golang Data Races",
	"tags": ["Go", "并发", "数据竞争", "并发安全", "not concurrency-safety", "concurrency-safety"],
	"description": "",
	"content": "关于Golang并发安全  谈谈go语言编程的并发安全 Benign Data Races: What Could Possibly Go Wrong?  什么是数据竞争 package main import ( \u0026quot;fmt\u0026quot; ) func main() { var i int go func() { i = 5 }() fmt.Println(i) } 先通过以上程序来了解什么是数据竞争。首先声明一个变量i，默认值为0。然后开启一个单独的goroutine来设置i的值。 同时，在不知道开启的goroutine是否已经执行完成的情况下打印i的值。所以，当前正在发生两个操作：\n 变量i的值正在被设置为5 打印i的值  所以，最后程序打印出来的值可能是0或者5。这就叫数据竞争，i的值根据以上两个操作哪一个先完成而不同。\n检测数据竞争 Golang有一个内置的数据竞争检测器，只需要在使用Go命令行工具的时候添加-race标志。例如：让我们尝试用-race标志来 运行我们刚刚编写的程序：\n$ go run -race main.go 0 ================== WARNING: DATA RACE Write at 0x00c000122068 by goroutine 7: main.main.func1() F:/go_project/api-service/test/core/main.go:10 +0x3f Previous read at 0x00c000122068 by main goroutine: main.main() F:/go_project/api-service/test/core/main.go:12 +0x8f Goroutine 7 (running) created at: main.main() F:/go_project/api-service/test/core/main.go:9 +0x81 ================== Found 1 data race(s) exit status 66 0是打印结果，第一部分告诉我们在子goroutine中尝试写入的位置，第二部分告诉我们在主goroutine中，同时有一个读的操作。 第三部分描述了导致数据竞争的goroutine是在哪里创建。 除了go run名另外，go build和go test命令也支持使用-race标志。这个会使编译器创建的应用程序能够记录所有运行期 间对共享变量访问，并且会记录下每一个读或者写共享变量的goroutine的身份信息。\n竞争检查器会报告所有的已经发生的数据竞争。然而，它只能检测到运行时的竞争条件，并不能证明之后不会发生数据竞争。由于需要额外 的记录，因此构建时加了竞争检测的程序跑起来会慢一些，且需要更大的内存，即使是这样，这些代价对于很多生产环境的工作来说还是可 以接受的。对于一些偶发的竞争条件来说，使用附带竞争检查器的应用程序可以节省很多花在Debug上的时间。\n数据竞争解决方案 Go提供了很多解决它的选择。所有这些解决方案的思路都是确保在我们写入变量时阻止对该变量的访问。一般常用的解决数据竞争的方案有： 使用WaitGroup锁，使用通道阻塞以及使用Mutex锁，下面我们一个个来看他们的用法并比较一下这几种方案的不同点。\n使用WaitGroup func main() { var i int var wg sync.WaitGroup wg.Add(1) // 通知程序有一个需要等待完成的任务 go func() { i = 5 wg.Done() // 告诉程序任务已经执行完成 }() wg.Wait() // 阻塞当前程序直到等待的任务执行完成 fmt.Println(i) } 使用通道 func main() { var i int wait := make(chan struct{}) go func() { i = 5 wait \u0026lt;- struct{}{} }() \u0026lt;-wait fmt.Println(i) } 使用Mutex 以上两种解决方案都是在确定的读取和写入顺序的情况下来保证数据的一致性。当程序读取和写入的先后顺序不固定的时候，以上方案便不能满足我们。 这种情况下我们应该考虑使用Mutex互斥锁。使用互斥锁，可以保证读取和写入操作不能同时发生。\ntype SafeNumber struct { i int m sync.Mutex } func (sn *SafeNumber) Set(n int) { sn.m.Lock() defer sn.m.Unlock() sn.i = n } func (sn *SafeNumber) Get() int { sn.m.Lock() defer sn.m.Unlock() return sn.i } func main() { sn := new(SafeNumber) go func() { sn.Set(5) }() fmt.Println(sn.Get()) } "
},
{
	"uri": "http://echotrue.github.io/algorithm/golang-search-slice/",
	"title": "Golang Search Slice",
	"tags": ["Go", "Slice"],
	"description": "",
	"content": "题目  假设有一个超长的切片，切片的元素类型为int，切片中的元素为乱序排列。限时5秒，使用多个goroutine查找切片中是否存在给定值， 在找到目标值或者超时后立刻结束所有goroutine的执行。比如切片为：[23, 32, 78, 43, 76, 65, 345, 762, …… 915, 86]， 查找的目标值为345，如果切片中存在目标值程序输出:\u0026ldquo;Found it!\u0026ldquo;并且立即取消仍在执行查找任务的goroutine。如果在超时时间未 找到目标值程序输出:\u0026ldquo;Timeout! Not Found\u0026rdquo;，同时立即取消仍在执行查找任务的goroutine。\n 首先题目里提到了在找到目标值或者超时后立刻结束所有goroutine的执行，完成这两个功能需要借助计时器、通道和context才行。 我能想到的第一点就是要用context.WithCancel创建一个上下文对象传递给每个执行任务的goroutine，外部在满足条件后（找到目标值或者已超时） 通过调用上下文的取消函数来通知所有goroutine停止工作。\n解法 package main\rimport (\r\u0026quot;context\u0026quot;\r\u0026quot;fmt\u0026quot;\r\u0026quot;os\u0026quot;\r\u0026quot;time\u0026quot;\r)\rfunc main() {\rtimer := time.NewTimer(time.Second * 5)\rdata := []int{1, 2, 3, 10, 999, 8, 345, 7, 98, 33, 66, 77, 88, 68, 96}\rdataLen := len(data)\rsize := 3\rtarget := 345\rctx, cancel := context.WithCancel(context.Background())\rresultChan := make(chan bool)\rfor i := 0; i \u0026lt; dataLen; i += size {\rend := i + size\rif end \u0026gt;= dataLen {\rend = dataLen - 1\r}\rgo SearchTarget(ctx, data[i:end], target, resultChan)\r}\rselect {\rcase \u0026lt;-timer.C:\rfmt.Fprintln(os.Stderr, \u0026quot;Timeout! Not Found\u0026quot;)\rcancel()\rcase \u0026lt;-resultChan:\rfmt.Fprintf(os.Stdout, \u0026quot;Found it!\\n\u0026quot;)\rcancel()\r}\rtime.Sleep(time.Second * 2)\r}\rfunc SearchTarget(ctx context.Context, data []int, target int, resultChan chan bool) {\rfor _, v := range data {\rselect {\rcase \u0026lt;-ctx.Done():\rfmt.Fprintf(os.Stdout, \u0026quot;Task cancelded! \\n\u0026quot;)\rreturn\rdefault:\r}\r// 模拟一个耗时查找，这里只是比对值，真实开发中可以是其他操作\rfmt.Fprintf(os.Stdout, \u0026quot;v: %d \\n\u0026quot;, v)\rtime.Sleep(time.Millisecond * 1500)\rif target == v {\rresultChan \u0026lt;- true\rreturn\r}\r}\r}\r"
},
{
	"uri": "http://echotrue.github.io/golang/log/",
	"title": "Log",
	"tags": ["Go", "log"],
	"description": "",
	"content": "Write log to both console and file consoleWriter := os.Stdout // os.Stderr w, err := os.OpenFile(\u0026quot;./app.log\u0026quot;, os.O_APPEND|os.O_CREATE|os.O_RDWR, os.ModeAppend|os.ModePerm) if err != nil { log.Fatal(err) } logWriter := io.MultiWriter(consoleWriter, w) l := log.New(logWriter, \u0026quot;---\u0026gt;\u0026quot;, log.LstdFlags|log.Lshortfile) l.Println(\u0026quot;this is a log\u0026quot;) "
},
{
	"uri": "http://echotrue.github.io/tags/log/",
	"title": "log",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/categories/log/",
	"title": "log",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/shortcodes/mermaid/",
	"title": "Mermaid",
	"tags": [],
	"description": "Generation of diagram and flowchart from text in a similar manner as markdown",
	"content": "Mermaid is a library helping you to generate diagram and flowcharts from text, in a similar manner as Markdown.\nJust insert your mermaid code in the mermaid shortcode and that\u0026rsquo;s it.\nFlowchart example {{\u0026lt;mermaid align=\u0026quot;left\u0026quot;\u0026gt;}}\rgraph LR;\rA[Hard edge] --\u0026gt;|Link text| B(Round edge)\rB --\u0026gt; C{Decision}\rC --\u0026gt;|One| D[Result one]\rC --\u0026gt;|Two| E[Result two]\r{{\u0026lt; /mermaid \u0026gt;}}\r renders as\ngraph LR;\rA[Hard edge] --|Link text| B(Round edge)\rB -- C{Decision}\rC --|One| D[Result one]\rC --|Two| E[Result two]\r\ror you can use this alternative syntax:\nrenders as\ngraph LR;\rA[Hard edge] --\u0026gt;|Link text| B(Round edge)\rB --\u0026gt; C{Decision}\rC --\u0026gt;|One| D[Result one]\rC --\u0026gt;|Two| E[Result two]\rSequence example {{\u0026lt;mermaid\u0026gt;}}\rsequenceDiagram\rparticipant Alice\rparticipant Bob\rAlice-\u0026gt;\u0026gt;John: Hello John, how are you?\rloop Healthcheck\rJohn-\u0026gt;John: Fight against hypochondria\rend\rNote right of John: Rational thoughts \u0026lt;br/\u0026gt;prevail...\rJohn--\u0026gt;Alice: Great!\rJohn-\u0026gt;Bob: How about you?\rBob--\u0026gt;John: Jolly good!\r{{\u0026lt; /mermaid \u0026gt;}}\r renders as\nsequenceDiagram\rparticipant Alice\rparticipant Bob\rAlice-John: Hello John, how are you?\rloop Healthcheck\rJohn-John: Fight against hypochondria\rend\rNote right of John: Rational thoughts prevail...\rJohn--Alice: Great!\rJohn-Bob: How about you?\rBob--John: Jolly good!\r\ror you can use this alternative syntax:\nrenders as\nsequenceDiagram\rparticipant Alice\rparticipant Bob\rAlice-\u0026gt;\u0026gt;John: Hello John, how are you?\rloop Healthcheck\rJohn-\u0026gt;John: Fight against hypochondria\rend\rNote right of John: Rational thoughts \u0026lt;br/\u0026gt;prevail...\rJohn--\u0026gt;Alice: Great!\rJohn-\u0026gt;Bob: How about you?\rBob--\u0026gt;John: Jolly good!\rGANTT Example {{\u0026lt;mermaid\u0026gt;}}\rgantt\rdateFormat YYYY-MM-DD\rtitle Adding GANTT diagram functionality to mermaid\rsection A section\rCompleted task :done, des1, 2014-01-06,2014-01-08\rActive task :active, des2, 2014-01-09, 3d\rFuture task : des3, after des2, 5d\rFuture task2 : des4, after des3, 5d\rsection Critical tasks\rCompleted task in the critical line :crit, done, 2014-01-06,24h\rImplement parser and jison :crit, done, after des1, 2d\rCreate tests for parser :crit, active, 3d\rFuture task in critical line :crit, 5d\rCreate tests for renderer :2d\rAdd to mermaid :1d\r{{\u0026lt; /mermaid \u0026gt;}}\r renders as\ngantt\rdateFormat YYYY-MM-DD\rtitle Adding GANTT diagram functionality to mermaid\rsection A section\rCompleted task :done, des1, 2014-01-06,2014-01-08\rActive task :active, des2, 2014-01-09, 3d\rFuture task : des3, after des2, 5d\rFuture task2 : des4, after des3, 5d\rsection Critical tasks\rCompleted task in the critical line :crit, done, 2014-01-06,24h\rImplement parser and jison :crit, done, after des1, 2d\rCreate tests for parser :crit, active, 3d\rFuture task in critical line :crit, 5d\rCreate tests for renderer :2d\rAdd to mermaid :1d\r\ror you can use this alternative syntax:\nrenders as\ngantt\rdateFormat YYYY-MM-DD\rtitle Adding GANTT diagram functionality to mermaid\rsection A section\rCompleted task :done, des1, 2014-01-06,2014-01-08\rActive task :active, des2, 2014-01-09, 3d\rFuture task : des3, after des2, 5d\rFuture task2 : des4, after des3, 5d\rsection Critical tasks\rCompleted task in the critical line :crit, done, 2014-01-06,24h\rImplement parser and jison :crit, done, after des1, 2d\rCreate tests for parser :crit, active, 3d\rFuture task in critical line :crit, 5d\rCreate tests for renderer :2d\rAdd to mermaid :1d\rClass example renders as\nclassDiagram\rClass01 \u0026lt;|-- AveryLongClass : Cool\rClass03 *-- Class04\rClass05 o-- Class06\rClass07 .. Class08\rClass09 --\u0026gt; C2 : Where am i?\rClass09 --* C3\rClass09 --|\u0026gt; Class07\rClass07 : equals()\rClass07 : Object[] elementData\rClass01 : size()\rClass01 : int chimp\rClass01 : int gorilla\rClass08 \u0026lt;--\u0026gt; C2: Cool label\rGit example renders as\ngitGraph:\roptions\r{\r\u0026quot;nodeSpacing\u0026quot;: 150,\r\u0026quot;nodeRadius\u0026quot;: 10\r}\rend\rcommit\rbranch newbranch\rcheckout newbranch\rcommit\rcommit\rcheckout master\rcommit\rcommit\rmerge newbranch\r"
},
{
	"uri": "http://echotrue.github.io/tags/not-concurrency-safety/",
	"title": "not concurrency-safety",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/shortcodes/notice/",
	"title": "Notice",
	"tags": [],
	"description": "Disclaimers to help you structure your page",
	"content": "The notice shortcode shows 4 types of disclaimers to help you structure your page.\nNote {{% notice note %}}\rA notice disclaimer\r{{% /notice %}}\rrenders as\nA notice disclaimer\n\rInfo {{% notice info %}}\rAn information disclaimer\r{{% /notice %}}\rrenders as\nAn information disclaimer\n\rTip {{% notice tip %}}\rA tip disclaimer\r{{% /notice %}}\rrenders as\nA tip disclaimer\n\rWarning {{% notice warning %}}\rA warning disclaimer\r{{% /notice %}}\rrenders as\nA warning disclaimer\n\r"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-1/",
	"title": "page 1",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-1/children-1-1/",
	"title": "page 1-1",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-1/children-1-1/children-1-1-1/",
	"title": "page 1-1-1",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-1/children-1-1/children-1-1-1/children-1-1-1-1/",
	"title": "page 1-1-1-1",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-1/children-1-1/children-1-1-1/children-1-1-1-1/children-1-1-1-1-1/",
	"title": "page 1-1-1-1-1",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-2/",
	"title": "page 2",
	"tags": [],
	"description": "",
	"content": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-3/",
	"title": "page 3",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page, not displayed in the menu\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-4/",
	"title": "page 4",
	"tags": [],
	"description": "This is a demo child page",
	"content": "This is a demo child page, not displayed in the menu\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/test/",
	"title": "page test",
	"tags": [],
	"description": "This is a page test",
	"content": "This is a test demo child page\n"
},
{
	"uri": "http://echotrue.github.io/shortcodes/children/children-2/test3/",
	"title": "page test 3",
	"tags": [],
	"description": "This is a page test",
	"content": "This is a test 3 demo child page\n"
},
{
	"uri": "http://echotrue.github.io/showcase/",
	"title": "Showcase",
	"tags": [],
	"description": "",
	"content": "TAT by OVH Tshark.dev by Ross Jacobs inteliver by Amir Lavasani "
},
{
	"uri": "http://echotrue.github.io/shortcodes/siteparam/",
	"title": "Site param",
	"tags": [],
	"description": "Get value of site params variables in your page.",
	"content": "siteparam shortcode is used to help you print values of site params.\nFor instance, in this current site, the editURL variable is used in config.toml\n[params] editURL = \u0026#34;https://github.com/matcornic/hugo-theme-learn/edit/master/exampleSite/content/\u0026#34; Use the siteparam shortcode to display its value.\n`editURL` Value : {{% siteparam \u0026quot;editURL\u0026quot; %}}\ris displayed as\neditURL Value :\n"
},
{
	"uri": "http://echotrue.github.io/tags/slice/",
	"title": "Slice",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/golang/sqlx/",
	"title": "Sqlx",
	"tags": [],
	"description": "",
	"content": "Handle Types (引用类型) sqlx旨在和database/sql具有相同的感觉，他有四种引用类型\n sqlx.DB 类似于sql.DB,是数据库的表示 sqlx.Tx类似于sql.Tx,是事务的表示 sqlx.Stmt类似于sql.Stmt,是预处理语句的表示 sqlx.NamedStmt是一种支持命名参数的预处理语句的表示  引用类型都嵌入了他们在database/sql中的等效物，这就意味着当你调用sqlx.DB.Query()，实际是调用与sql.DB.Query相同的代码。\n除此之外，还有两种光标类型：\nQuerying 101 (查询概述) 引用类型实现了以下相同的操作来查询数据库\n Exec(...) (sql.Result, error) - unchanged from database/sql Query(...) (*sql.Rows, error) - unchanged from database/sql QueryRow(...) *sql.Row - unchanged from database/sql  以下这些是内置操作的扩展\n MustExec() sql.Result \u0026ndash; Exec, but panic on error Queryx(...) (*sqlx.Rows, error) - Query, but return an sqlx.Rows QueryRowx(...) *sqlx.Row \u0026ndash; QueryRow, but return an sqlx.Row  还有这些新的语义：\n Get(dest interface{}, ...) error Select(dest interface{}, ...) error  Exec and MustExec 这两个方法都是用于执行插入，修改以及DDL语句。区别是他们的错误处理机制不一样，Exec会将结果和错误返回，由开发者自行处理。而MustExec遇到错误会抛出恐慌panic\n// Create table schema := `CREATE TABLE place (country text,city text NULL,telcode integer);` result, err := db.Exec(schema) if err != nil { log.Fatalln(err) } // Insert schema := `INSERT INTO place (country,telcode) VALUES (?,?)` result := db.MustExec(schema, \u0026#34;Hong Kong\u0026#34;, 852) //result.LastInsertId() //result.RowsAffected() Query // fetch all places from the db rows, err := db.Query(\u0026#34;SELECT country, city, telcode FROM place\u0026#34;) // iterate over each row for rows.Next() { var country string // note that city can be NULL, so we use the NullString type \tvar city sql.NullString var telcode int err = rows.Scan(\u0026amp;country, \u0026amp;city, \u0026amp;telcode) } // check the error from rows err = rows.Err() 应该像数据库游标一样看待Rows，而不是将其看作一个具体的结果集。尽管数据库驱动缓冲行为有所不同，但是通过Next()迭代能够有效的约束大型查询结果集的内存使用，因为一次只扫描一行。Scan()通过反射来将数据库列的类型映射到Go的类型，例如：string,[]byte等等。如果不迭代所有行的结果，请确保调用rows.Close()以便将连接返回到连接池。 Query查询返回的error是数据库服务preparing或executing过程中发生的任意错误。这些错误包含从连接池中获取无效的连接，尽管database/sql会重试10次来尝试找到或创建正常的连接。通常，这些错误是由SQL语法错误，类型错误，字段名和表明错误引起。 大多数情况下，Rows.Scan会复制其从数据库驱动中获取的数据，因为它不知道数据库驱动将会如何重复使用缓冲区。特殊类型sql.RawBytes可以用来从数据库驱动返回的实际数据中获取一个零拷贝的字节切片。下次调用Next()之后，这个值将不再有效，因为这个值所在的内存可能已经被覆盖。 Query查询使用的连接会一直保持活跃状态，直到通过Next()迭代完查询出的所有行，或者rows.Close()被调用。此时，连接才会被释放。 Queryx和Query用法基本一样，只是他返回一个sqlx.Rows对象，这个对象拥有更加丰富的scan行为可供选择。\ntype Place struct { Country string City sql.NullString TelephoneCode int `db:\u0026quot;telcode\u0026quot;` } rows, err := db.Queryx(\u0026quot;SELECT * FROM place\u0026quot;) for rows.Next() { var p Place err = rows.StructScan(\u0026amp;p) } StructScan()是sql.Rows主要的扩展行为，他会扫描查询结果并映射到结构体字段中。注意，这些字段必须是导出的（首字母大写），以便sqlx能够将数据写入，这个规则适用于Go中的所有类型（json,xml）的Marshalling(编码)和UNMarshalling(解码)。可以使用结构体标签db指定数据表列名和结构体字段的映射关系，或者使用db.MapperFunc()设置新的默认映射关系。默认是使用strings.Lower将结构体字段转小写来匹配数据表列名。\nQueryRow QueryRow从数据表提取一条记录。它从连接池中获取一个连接，然后通过Query执行查询，返回一个内部包含Rows对象的Row对象。 与Query不同，QueryRow返回没有错误的Row类型结果，使得对查询结果的链式Scan操作是安全的。如果执行查询过程中发生错误，错误会通过Scan返回。如果没有查询到结果，Scan返回sql.ErrNoRows错误。如果Scan本身发生错误（例如：类型不匹配）,错误同样会被返回。 查询结果Row内部的Rows结构体在Scan执行完后会关闭，这就意味着，QueryRow查询所在的数据库连接一直会保持到查询结果被扫描完。同样意味着sql.RawBytes在这里也不可用，由于被引用的内存块属于数据库驱动，并且调用返回时该内存块可能已经无效。 sqlx扩展的方法QueryRowx会返回sqlx.Row代替sql.Row，它实现了上述介绍以及高阶扫描中Rows相同的扫描扩展。\nGet and Select Get和Select是引用类型的节省时间的扩展，它将查询的执行和灵活的扫描语义相结合。为了清楚的解释它们，我们不得不谈论下什么是scannable(可扫描的)：\n 不是结构体类型的值是可扫描的，例如：string, int 实现了sql.Scanner接口的值是可扫描的 没有导出字段的结构体可以是扫描的(eg. time.Time) Get和Select使用rows.Scan在可扫描类型上，使用rows.StructScan在不可扫描类型上。它们与QueryRow和Query大致相似，Get主要用来获取单条记录并扫描它，Select主要用来获取一个结果集。  p := Place{} pp := []Place{} // this will pull the first place directly into p err = db.Get(\u0026amp;p, \u0026#34;SELECT * FROM place LIMIT 1\u0026#34;) // this will pull places with telcode \u0026gt; 50 into the slice pp err = db.Select(\u0026amp;pp, \u0026#34;SELECT * FROM place WHERE telcode \u0026gt; ?\u0026#34;, 50) // they work with regular types as well var id int err = db.Get(\u0026amp;id, \u0026#34;SELECT count(*) FROM place\u0026#34;) // fetch at most 10 place names var names []string err = db.Select(\u0026amp;names, \u0026#34;SELECT name FROM place LIMIT 10\u0026#34;) Get和Select都将会关闭它们在查询执行过程中创建的Rows对象，并且返回在这个过程中发生的任何错误。由于它们在内部使用StructScan,因此\u0026quot;高级扫描\u0026quot;中介绍的部分也适用于这两个方法。 Select可以为你节省很多输入，但是，请谨记！它在语义上和Queryx不同，因为它会将整个查询结果集一次性的加载进内存，如果这个结果集没有被查询限制到一个合理的大小，使用经典的Queryx/StructScan迭代反而是更好的选择。\nTransactions (事务) 要使用事务，首选需要通过DB.Begin()创建一个事务的引用对象。记住，Exec以及其他查询动作每次都会向DB索要一个连接，并且最终会将连接放回连接池。由于无法保证你每次索要的连接与Begin()执行时所在的连接是同一个连接，所以，要使用事务，必须先调用DB.Begin().正确的使用方法如下：\ntx, err := db.Begin() err = tx.Exec(...) err = tx.Commit() DB引用也有扩展行为Beginx()和MustBegin(),他们返回sqlx.Tx而不是sql.Tx。sqlx.Tx拥有sqlx.DB的所有扩展行为。 一旦事务是连接状态，Tx对象必须绑定并限定为单个从池中获取的连接，Tx在其整个生命周期中都将维持单个连接，只有调用Commit()或Rollback()才会释放连接。需要注意的是你应该至少调用这两个方法中的一个，否则，连接将会一直保持直到被GC回收。 由于在事务中只有一个连接可以被使用，所以一次只能执行一条语句。在执行其他查询之前，必须分别扫描完或关闭Row 和 Rows。在数据库服务器向你发送结果的时候，如果你尝试向数据库发送数据，这很可能会破坏当前连接。 Tx对象实际并不意味着在服务器上的任何行为，它只是执行了begin语句并绑定了单个连接。事务的实际行为，诸如：锁定和隔离等，在此不做具体说明，这些依赖于数据库。\nPrepared Statement （预处理语句） 在大多数数据库中，每当查询被执行时，语句会在后台被预处理。然而，你可以使用sqlx.DB.Prepare()显式的预处理语句，以便在其他地方可以重复使用。\nstmt, err := db.Prepare(`SELECT * FROM place WHERE telcode=?`) row = stmt.QueryRow(65) tx, err := db.Begin() txStmt, err := tx.Prepare(`SELECT * FROM place WHERE telcode=?`) row = txStmt.QueryRow(852) Prepare实际会在数据库执行预处理操作，所以，它需要占用一个链接。database/sql会抽象这一点：通过自动在新的链接上执行预处理操作，允许你使用同一个Stmt对象同时在多个连接上执行语句。Preparex()返回一个sqlx.Stmt对象，它拥有sqlx.DB和sqlx.Tx两个扩展的所有行为。\nstmt, err := db.Preparex(`SELECT * FROM place WHERE telcode=?`) var p Place err = stmt.Get(\u0026amp;p, 852) 标准的sql.Tx对象也有一个Stmt()方法，它从一个已存在的Stmt对象中返回一个用于事务的特定Stmt对象。sqlx.Tx也有一个Stmtx的版本，它从一个已存在的sql.Stmt或sqlx.Stmt对象中创建一个用于事务的特定sqlx.Stmt对象。 关于Stmt对象，可参考pkg.go.dev中database/sql文档中的阶段概述：\n Stmt is a prepared statement. A Stmt is safe for concurrent use by multiple goroutines. If a Stmt is prepared on a Tx or Conn, it will be bound to a single underlying connection forever. If the Tx or Conn closes, the Stmt will become unusable and all operations will return an error. If a Stmt is prepared on a DB, it will remain usable for the lifetime of the DB. When the Stmt needs to execute on a new underlying connection, it will prepare itself on the new connection automatically.\n Query Helpers "
},
{
	"uri": "http://echotrue.github.io/tags/%E4%B8%8A%E4%B8%8B%E6%96%87/",
	"title": "上下文",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E5%88%87%E7%89%87/",
	"title": "切片",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E5%B9%B6%E5%8F%91/",
	"title": "并发",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8/",
	"title": "并发安全",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E6%95%B0%E6%8D%AE%E7%AB%9E%E4%BA%89/",
	"title": "数据竞争",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://echotrue.github.io/tags/%E6%95%B0%E7%BB%84/",
	"title": "数组",
	"tags": [],
	"description": "",
	"content": ""
}]